version: "3.1"

stories:

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # âœ… AVA directo
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_soporte_ava_directo
    steps:
      - user: "soporte ava"
        intent: soporte_ava_directo
      - action: utter_soporte_ava

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸš¨ Fallback unificado (1 disparo)
  #   Espera: utter_default â†’ utter_fallback
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_fallback_unificado_una_vez
    steps:
      - user: "Â¿Â¿???"
        intent: nlu_fallback
      - action: utter_default
      - action: utter_fallback

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸš¨ Fallback unificado (2 disparos seguidos)
  #   Repite la misma secuencia
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_fallback_unificado_dos_veces
    steps:
      - user: "??"
        intent: nlu_fallback
      - action: utter_default
      - action: utter_fallback
      - user: "no entiendo"
        intent: nlu_fallback
      - action: utter_default
      - action: utter_fallback

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§° Soporte form (camino feliz)
  #   soporte_tecnico â†’ soporte_form â†’ ask/slot â†’ submit â†’ ok
  #   (Orden correcto: primero pregunta el bot, luego responde el usuario)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_soporte_form_happy_path
    steps:
      - user: "necesito soporte tÃ©cnico"
        intent: soporte_tecnico
      - action: soporte_form
      - active_loop: soporte_form

      # nombre
      - action: utter_ask_nombre
      - user: "Carlos Ruiz"
        intent: pedir_nombre
      - action: soporte_form

      # email
      - action: utter_ask_email
      - user: "carlos@example.com"
        intent: enviar_correo
      - action: soporte_form

      # mensaje
      - action: utter_ask_mensaje
      - user: "Se queda en pantalla blanca al entrar al curso"
        intent: pedir_mensaje
      - action: soporte_form

      # submit del form â†’ tus reglas existentes
      - active_loop: null
      - action: utter_soporte_resumen
      - action: action_soporte_submit
      - action: utter_soporte_creado
      - action: utter_soporte_form_ok

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§° Soporte form (cancelado por deny)
  #   soporte_tecnico â†’ soporte_form â†’ (bot pregunta) â†’ deny â†’ cierre
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_soporte_form_cancel
    steps:
      - user: "soporte por favor"
        intent: soporte_tecnico
      - action: soporte_form
      - active_loop: soporte_form

      # Bot pregunta el primer slot (puede ser nombre)
      - action: utter_ask_nombre
      - user: "no"
        intent: deny

      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_gracias_continuar

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ”‘ Recovery (camino feliz)
  #   recuperar_contrasena â†’ recovery_form â†’ ask email â†’ submit
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_recovery_form_happy_path
    steps:
      - user: "olvidÃ© mi clave"
        intent: recuperar_contrasena
      - action: recovery_form
      - active_loop: recovery_form

      - action: utter_ask_email
      - user: "user@demo.com"
        intent: enviar_correo
      - action: recovery_form

      - active_loop: null
      - action: action_enviar_correo
      - action: utter_confirmar_recuperacion

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ” Ingreso â†’ instrucciones Zajuna
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_ingreso_zajuna_instrucciones
    steps:
      - user: "quiero ingresar a zajuna"
        intent: ingreso_zajuna
      - action: utter_ingreso_zajuna_instrucciones

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§© Flujo hÃ­brido: Estado SIN token (embed o web sin auth)
  #   Debe ir a utter_need_auth luego de sincronizar metadata
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_estado_sin_token
    steps:
      - user: "/estado_estudiante"
        intent: estado_estudiante
        metadata:
          auth:
            hasToken: false
      - action: action_sync_auth_from_metadata
      - slot_was_set:
          - has_token: false
      - action: utter_need_auth

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§© Flujo hÃ­brido: Estado CON token
  #   Ejecuta la acciÃ³n real
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_estado_con_token
    steps:
      - user: "/estado_estudiante"
        intent: estado_estudiante
        metadata:
          auth:
            hasToken: true
      - action: action_sync_auth_from_metadata
      - slot_was_set:
          - has_token: true
      - action: action_estado_estudiante

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§© Flujo hÃ­brido: Certificados SIN token
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_certificados_sin_token
    steps:
      - user: "/ver_certificados"
        intent: ver_certificados
        metadata:
          auth:
            hasToken: false
      - action: action_sync_auth_from_metadata
      - slot_was_set:
          - has_token: false
      - action: utter_need_auth

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§© Flujo hÃ­brido: Certificados CON token
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_certificados_con_token
    steps:
      - user: "/ver_certificados"
        intent: ver_certificados
        metadata:
          auth:
            hasToken: true
      - action: action_sync_auth_from_metadata
      - slot_was_set:
          - has_token: true
      - action: action_ver_certificados

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§© CTA bot: "Abrir chat autenticado"
  #   (lleva a un hint; tu frontend abre /chat en nueva pestaÃ±a)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - story: test_cta_abrir_chat_autenticado
    steps:
      - user: "abrir chat autenticado"
        intent: abrir_chat_autenticado
      - action: utter_login_hint
