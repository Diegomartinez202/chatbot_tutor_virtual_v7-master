version: "3.1"

intents:
  - escalar_humano
  - confirmacion_escalar_humano
  - negar_escalar
  - solicitar_soporte
  - affirm
  - deny
  - necesita_humano
  - confirmar_derivacion   
  - negar_derivacion  
forms:
  soporte_form:
    required_slots:
      - motivo_soporte
      - detalle_soporte
      - email_contacto

slots:
  motivo_soporte:
    type: text
    influence_conversation: true
  detalle_soporte:
    type: text
    influence_conversation: true
  email_contacto:
    type: text
    influence_conversation: true
  soporte_intentos:
    type: any
    influence_conversation: false
    initial_value: 0
responses:
  utter_ofrecer_humano:
    - text: "¬øDeseas que te contacte un asesor humano?"
      buttons:
        - title: "S√≠, por favor"
          payload: "/confirmacion_escalar_humano"
        - title: "No, continuar con el bot"
          payload: "/negar_escalar"

  utter_handoff_iniciado:
    - text: "Perfecto. Para derivarte con un asesor humano necesito algunos datos."

  utter_ask_motivo_soporte:
    - text: "Cu√©ntame brevemente el motivo de tu solicitud de soporte."

  utter_ask_detalle_soporte:
    - text: "¬øPuedes darme m√°s detalle para ayudar al asesor a contextualizar?"

  utter_ask_email_contacto:
    - text: "¬øCu√°l es tu correo de contacto?"

  utter_handoff_en_cola:
    - text: "‚úÖ He registrado tu caso y te contactar&aacute; un asesor. Te avisar√© por este canal y por correo."

  utter_pedir_derivacion:
    - text: "¬øDeseas que te ponga en contacto con un asesor humano?"
      buttons:
        - title: "S√≠, con gusto"
          payload: "/confirmar_derivacion"
        - title: "No, sigo con el bot"
          payload: "/negar_derivacion"

  utter_derivar_humano_en_progreso:
    - text: "Conect√°ndote con un asesor... ‚åõ Por favor espera un momento."

  utter_derivacion_cancelada:
    - text: "Sin problema. Continuamos por aqu√≠. ¬øQu√© deseas hacer?"
      buttons:
        - title: "üè† Men√∫ principal"
          payload: "/ir_menu_principal"

  # Mensaje cuando el usuario falla dentro del form y vamos a derivar
  utter_handoff_por_fallos:
    - text: "Veo que hubo varias dificultades. Te conectar√© con un asesor humano para ayudarte mejor."

  # Mensaje de intento fallido dentro del form (1 y 2)
  utter_intento_form_fallido:
    - text: "No logr√© entender del todo. ¬øPodr√≠as intentarlo de otra forma?"

actions:
  - validate_soporte_form
  - action_submit_soporte
  - action_derivar_y_registrar_humano
