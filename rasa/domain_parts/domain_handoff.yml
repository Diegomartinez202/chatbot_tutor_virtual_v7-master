version: "3.1"

intents:
  - escalar_humano
  - confirmacion_escalar_humano
  - negar_escalar
  - necesita_humano
  - confirmar_derivacion
  - negar_derivacion
  - solicitar_soporte
  - terminar_conversacion

slots:
  soporte_intentos:
    type: any
    influence_conversation: false
    initial_value: 0

responses:

  utter_ofrecer_humano:
    - text: "Â¿Deseas que te contacte un asesor humano?"
      buttons:
        - title: "SÃ­, por favor"
          payload: "/confirmacion_escalar_humano"
        - title: "No, continuar con el bot"
          payload: "/negar_escalar"
        - title: "ğŸ’¾ Terminar y guardar progreso"
          payload: "/terminar_conversacion_segura_autosave"

  utter_handoff_iniciado:
    - text: "Perfecto. Para derivarte con un asesor humano necesito algunos datos."

  # Preguntas del form (las usarÃ¡ tu soporte_form ya definido en otro domain part)
  utter_ask_motivo_soporte:
    - text: "CuÃ©ntame brevemente el motivo de tu solicitud de soporte."

  utter_ask_detalle_soporte:
    - text: "Â¿Puedes darme mÃ¡s detalle para ayudar al asesor a contextualizar?"

  utter_ask_email_contacto:
    - text: "Â¿CuÃ¡l es tu correo de contacto?"

  utter_handoff_en_cola:
    - text: "âœ… He registrado tu caso y te contactar&aacute; un asesor. Te avisarÃ© por este canal y por correo."
      buttons:
        - title: "ğŸ  Volver al menÃº principal"
          payload: "/ir_menu_principal"
        - title: "ğŸ’¾ Terminar y guardar progreso"
          payload: "/terminar_conversacion_segura_autosave"

  utter_pedir_derivacion:
    - text: "Â¿Deseas que te ponga en contacto con un asesor humano?"
      buttons:
        - title: "SÃ­, con gusto"
          payload: "/confirmar_derivacion"
        - title: "No, sigo con el bot"
          payload: "/negar_derivacion"

  utter_derivar_humano_en_progreso:
    - text: "ConectÃ¡ndote con un asesor... âŒ› Por favor espera un momento."

  utter_derivacion_cancelada:
    - text: "Sin problema. Continuamos por aquÃ­. Â¿QuÃ© deseas hacer?"
      buttons:
        - title: "ğŸ  MenÃº principal"
          payload: "/ir_menu_principal"
        - title: "ğŸ“ Ver estado acadÃ©mico"
          payload: "/ver_estado_estudiante"
        - title: "ğŸ“œ Consultar certificados"
          payload: "/consultar_certificados"
        - title: "ğŸ’¾ Terminar y guardar progreso"
          payload: "/terminar_conversacion_segura_autosave"

  # Mensaje cuando el usuario falla varias veces en el form
  utter_handoff_por_fallos:
    - text: "Veo que hubo varias dificultades. Te conectarÃ© con un asesor humano para ayudarte mejor."
      buttons:
        - title: "âœ… Continuar con derivaciÃ³n a humano"
          payload: "/confirmacion_escalar_humano"
        - title: "ğŸ’¾ Terminar y guardar progreso"
          payload: "/terminar_conversacion_segura_autosave"

  # Mensaje de intento fallido dentro del form
  utter_intento_form_fallido:
    - text: "No logrÃ© entender del todo. Â¿PodrÃ­as intentarlo de otra forma?"
      buttons:
        - title: "Intentar de nuevo"
          payload: "/necesita_humano"
        - title: "ğŸ’¾ Terminar y guardar progreso"
          payload: "/terminar_conversacion_segura_autosave"

actions:
  - action_registrar_intento_form
  - action_verificar_max_intentos_form
  - action_ofrecer_humano
  - action_handoff_cancelar
  - action_derivar_humano_confirmada
  - action_cancelar_derivacion
  - action_soporte_submit
  - action_derivar_y_registrar_humano
