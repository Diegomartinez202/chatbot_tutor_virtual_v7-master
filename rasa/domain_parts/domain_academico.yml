# ============================================
# ğŸ“ DOMAIN ACADÃ‰MICO - Tutor Virtual Zajuna
# ============================================
version: "3.1"

# ============================================
# ğŸ“Œ INTENCIONES RELACIONADAS
# ============================================
intents:
  - consultar_academico
  - consultar_certificados
  - consultar_estado_estudiante
  - tutor_asignado
  - confirmar_autenticacion
  - negar_autenticacion
  - volver_menu
  - respuesta_satisfecho
  - respuesta_insatisfecho
  - ir_menu_principal
  - terminar_conversacion
  - estado_estudiante
  - ver_estado_estudiante
  - ver_estado_estudiante_info
  - ver_certificados_info
  - proceso_academico_secundario
  - ver_certificados
  - iniciar_sesion
  - enviar_credenciales
  - deny
  - affirm
  - fallback
  - cerrar_chat
  - is_authenticated

# ============================================
# ğŸ“¦ ENTIDADES Y SLOTS ESPECÃFICOS
# ============================================
entities:
  - curso
  - certificado
  - tutor
  - nombre_usuario
  - tipo_certificado
  - email
  - tipo_estado
slots:
  curso:
    type: text
    influence_conversation: true
    initial_value: null

  certificado:
    type: text
    influence_conversation: false
    initial_value: null

  tutor:
    type: text
    influence_conversation: false
    initial_value: null

  # ğŸ”‘ Token real (para backend)
  auth_token:
    type: text
    influence_conversation: false
    initial_value: null

  encuesta_tipo:
    type: text
    influence_conversation: true

  nombre_usuario:
    type: text
    influence_conversation: true

  tipo_estado:
    type: text
    influence_conversation: true


  is_authenticated:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom
  estudiante_id:
    type: text
    influence_conversation: false
    mappings:
      - type: custom
  tipo_certificado:
    type: categorical
    values:
      - certificado
      - constancia
      - historial
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: tipo_certificado
      - type: from_text
        conditions:
          - active_loop: certificado_form
            requested_slot: tipo_certificado
  confirm_terminar:
    type: bool
    influence_conversation: true
    mappings:
      - type: from_intent
        value: true
        intent: affirm
      - type: from_intent
        value: false
        intent: deny

# ============================================
# ğŸ’¬ RESPUESTAS ACADÃ‰MICAS
# ============================================
responses:

  # ğŸ”¹ MenÃº principal acadÃ©mico
  utter_menu_academico:
    - text: "ğŸ“š MenÃº acadÃ©mico de Zajuna:"
      buttons:
        - title: "ğŸ“œ Ver certificados"
          payload: "/consultar_certificados"
        - title: "ğŸ§¾ Estado de estudiante"
          payload: "/consultar_estado_estudiante"
        - title: "ğŸ‘¨â€ğŸ« Tutor asignado"
          payload: "/tutor_asignado"
        - title: "â¬…ï¸ Volver al menÃº principal"
          payload: "/volver_menu"

  # ğŸ” Solicitud de autenticaciÃ³n
  utter_necesita_autenticacion:
    - text: "âš ï¸ Para acceder a esta funciÃ³n, primero debes iniciar sesiÃ³n en Zajuna."
      buttons:
        - title: "ğŸ”‘ Iniciar sesiÃ³n"
          payload: "/autenticarse"
        - title: "â¬…ï¸ Volver al menÃº principal"
          payload: "/volver_menu"

  # ğŸ“œ Instrucciones paso a paso para certificados
  utter_pasos_descargar_certificados:
    - text: |
        ğŸ§¾ **CÃ³mo descargar tus certificados:**
        1ï¸âƒ£ Inicia sesiÃ³n en Zajuna: https://zajuna.edu/login  
        2ï¸âƒ£ En tu panel, abre **Certificados**.  
        3ï¸âƒ£ Selecciona el curso y pulsa **Descargar**.  
        4ï¸âƒ£ Si ya estÃ¡s autenticado, puedo mostrarte tus certificados disponibles.
      buttons:
        - title: "âœ… Ya iniciÃ© sesiÃ³n"
          payload: "/confirmar_autenticacion"
        - title: "â¬…ï¸ Volver al menÃº acadÃ©mico"
          payload: "/consultar_academico"

  # ğŸ“Š Instrucciones de estado acadÃ©mico
  utter_estado_estudiante_instrucciones:
    - text: |
        ğŸ“– **Para ver tu estado de estudiante:**
        1ï¸âƒ£ Ingresa a tu cuenta en Zajuna.  
        2ï¸âƒ£ Abre el menÃº **Perfil > Estado acadÃ©mico**.  
        3ï¸âƒ£ VerÃ¡s tu progreso, cursos activos y calificaciones.  
        4ï¸âƒ£ Si ya iniciaste sesiÃ³n, puedo consultarlo directamente.
      buttons:
        - title: "âœ… Ya iniciÃ© sesiÃ³n"
          payload: "/confirmar_autenticacion"
        - title: "â¬…ï¸ Volver al menÃº acadÃ©mico"
          payload: "/consultar_academico"

  # ğŸ‘©â€ğŸ« InformaciÃ³n de tutor asignado
  utter_tutor_info:
    - text: |
        ğŸ‘©â€ğŸ« Tu tutor asignado aparecerÃ¡ en el panel principal de Zajuna, secciÃ³n *Mis cursos*.
        Â¿Deseas que intente consultarlo por ti?
      buttons:
        - title: "SÃ­, consultar tutor"
          payload: "/confirmar_autenticacion"
        - title: "No, volver"
          payload: "/consultar_academico"

  # ğŸ“„ Resultados acadÃ©micos autenticados
  utter_autenticacion_requerida_certificados:
    - text: "ğŸ”’ Necesitas estar autenticado para ver certificados. Por favor, inicia sesiÃ³n primero."

  utter_certificados_listado:
    - text: "ğŸ“ AquÃ­ tienes tus certificados disponibles:\n{certificado}"
      buttons:
        - title: "Volver al menÃº acadÃ©mico"
          payload: "/consultar_academico"
        - title: "Ir al menÃº principal"
          payload: "/ir_menu_principal"

  utter_estado_estudiante_detalle:
    - text: "ğŸ“Š Estado actual del estudiante: {curso}"
      buttons:
        - title: "Volver al menÃº acadÃ©mico"
          payload: "/consultar_academico"
        - title: "Ir al menÃº principal"
          payload: "/ir_menu_principal"

  utter_tutor_detalle:
    - text: "ğŸ‘¨â€ğŸ« Tu tutor asignado es: {tutor}"
      buttons:
        - title: "Volver al menÃº acadÃ©mico"
          payload: "/consultar_academico"
        - title: "Ir al menÃº principal"
          payload: "/ir_menu_principal"

  # ğŸ’¬ Encuesta de satisfacciÃ³n
  utter_preguntar_satisfaccion:
    - text: "Â¿Quedaste satisfecho con la atenciÃ³n recibida?"
      buttons:
        - title: "SÃ­, satisfecho ğŸ˜„"
          payload: "/respuesta_satisfecho"
        - title: "No, insatisfecho ğŸ˜”"
          payload: "/respuesta_insatisfecho"

  utter_agradecimiento_satisfaccion:
    - text: "Â¡Gracias por tu valoraciÃ³n! ğŸ˜Š Me alegra haber podido ayudarte."

  utter_encuesta_insatisfaccion:
    - text: "Lamento que no hayas quedado satisfecho ğŸ˜”. Puedes dejar tu opiniÃ³n o contactar a tu tutor asignado para mayor soporte."

  utter_preguntar_continuar_menu:
    - text: "Â¿Deseas realizar otra consulta?"
      buttons:
        - title: "SÃ­, volver al menÃº principal"
          payload: "/ir_menu_principal"
        - title: "No, terminar conversaciÃ³n"
          payload: "/terminar_conversacion"
  # ===============================
  # âœ… Despedida profesional
  # ===============================
  utter_despedida_profesional:
    - text: "ğŸ‘‹ Gracias por usar el asistente Zajuna. Â¡Que tengas un excelente dÃ­a! ğŸŒŸ"
      buttons:
        - title: "ğŸ  Volver al menÃº"
          payload: /ir_menu_principal
        - title: "ğŸ“ Enviar comentario"
          payload: /iniciar_encuesta
        - title: "ğŸ” Cerrar sesiÃ³n"
          payload: /terminar_conversacion
    - text: "âœ¨ Fue un gusto ayudarte hoy. Si necesitas algo mÃ¡s, aquÃ­ estarÃ©."
      buttons:
        - title: "ğŸ“„ Certificados"
          payload: /consultar_certificados
        - title: "ğŸ“ Estado acadÃ©mico"
          payload: /ver_estado_estudiante
        - title: "ğŸ‘‹ Finalizar"
          payload: /terminar_conversacion

  # ===============================
  # ğŸ“Š Estado acadÃ©mico mostrado
  # ===============================
  utter_estado_mostrado:
    - text: |
        ğŸ“Š AquÃ­ tienes tu estado acadÃ©mico:
        {estado}

        Â¿QuÃ© deseas hacer ahora?
      buttons:
        - title: "ğŸ“š Ver detalle por mÃ³dulos"
          payload: /ver_estado_estudiante{"detalle":"modulos"}
        - title: "â¬‡ï¸ Descargar PDF"
          payload: /ver_estado_estudiante{"accion":"descargar"}
        - title: "ğŸ  MenÃº principal"
          payload: /ir_menu_principal
    - text: "âœ… Estado cargado correctamente. Â¿Te muestro avances por competencia o prefieres el resumen general?"
      buttons:
        - title: "ğŸ“Œ Por competencia"
          payload: /ver_estado_estudiante{"detalle":"competencias"}
        - title: "ğŸ§¾ Resumen general"
          payload: /ver_estado_estudiante{"detalle":"resumen"}
        - title: "â¬…ï¸ MenÃº"
          payload: /ir_menu_principal

  # ===============================
  # ğŸ” Solicitar autenticaciÃ³n
  # ===============================
  utter_pedir_autenticacion:
    - text: >
        ğŸ” Para consultar tus certificados o ver tu estado acadÃ©mico, necesito que inicies sesiÃ³n.
        Â¿Deseas iniciar ahora?
      buttons:
        - title: "âœ… SÃ­, iniciar sesiÃ³n"
          payload: /iniciar_sesion
        - title: "â“ Â¿CÃ³mo me autentico?"
          payload: /ver_login_hint
        - title: "â¬…ï¸ Volver al menÃº"
          payload: /ir_menu_principal
    - text: "Para continuar, autentÃ­cate por favor. Puedo guiarte en el proceso."
      buttons:
        - title: "ğŸ”‘ Iniciar sesiÃ³n"
          payload: /iniciar_sesion
        - title: "ğŸ“˜ Ver guÃ­a rÃ¡pida"
          payload: /ver_login_hint

  # ===============================
  # ğŸ“„ Certificados - usuario NO autenticado
  # ===============================
  utter_certificado_no_autenticado:
    - text: >
        ğŸš« AÃºn no has iniciado sesiÃ³n. Para listar o descargar certificados es necesario autenticarse.
      buttons:
        - title: "ğŸ”‘ Iniciar sesiÃ³n"
          payload: /iniciar_sesion
        - title: "â„¹ï¸ Â¿CÃ³mo iniciar?"
          payload: /ver_login_hint
        - title: "ğŸ  MenÃº"
          payload: /ir_menu_principal

  # ===============================
  # ğŸ“„ Certificados - listado
  # ===============================
  utter_certificado_listado:
    - text: |
        ğŸ“ Estos son tus certificados disponibles:
        {certificados}

        Â¿QuÃ© deseas hacer?
      buttons:
        - title: "ğŸ–ï¸ Descargar Certificado"
          payload: /consultar_certificados{"accion":"descargar","tipo_certificado":"certificado"}
        - title: "ğŸ§¾ Descargar Constancia"
          payload: /consultar_certificados{"accion":"descargar","tipo_certificado":"constancia"}
        - title: "ğŸ“œ Descargar Historial"
          payload: /consultar_certificados{"accion":"descargar","tipo_certificado":"historial"}
        - title: "ğŸ“§ Enviar al correo"
          payload: /consultar_certificados{"accion":"enviar_email"}
        - title: "â¬…ï¸ MenÃº"
          payload: /ir_menu_principal
    - text: "Â¿Quieres que los envÃ­e al correo registrado o prefieres descargarlos aquÃ­?"
      buttons:
        - title: "ğŸ“§ Enviar al correo"
          payload: /consultar_certificados{"accion":"enviar_email"}
        - title: "â¬‡ï¸ Descargar aquÃ­"
          payload: /consultar_certificados{"accion":"descargar"}

  # ===============================
  # âœ‰ï¸ ConfirmaciÃ³n de envÃ­o de certificados
  # ===============================
  utter_confirmacion_consulta:
    - text: "âœ… He enviado tus certificados al correo registrado. Revisa tu bandeja de entrada (y spam)."
      buttons:
        - title: "ğŸ“„ Ver otras opciones"
          payload: /consultar_certificados
        - title: "ğŸ  MenÃº"
          payload: /ir_menu_principal
    - text: "ğŸ“¬ EnvÃ­o completado. Â¿Deseas descargar una copia local en PDF?"
      buttons:
        - title: "â¬‡ï¸ SÃ­, descargar"
          payload: /consultar_certificados{"accion":"descargar"}
        - title: "No, gracias"
          payload: /ir_menu_principal

  # ===============================
  # ğŸ“Š Estado acadÃ©mico (texto simple + acciones)
  # ===============================
  utter_estado_estudiante:
    - text: |
        ğŸ“Š Tu estado acadÃ©mico actual:
        {estado}
      buttons:
        - title: "ğŸ“š Ver detalle"
          payload: /ver_estado_estudiante{"detalle":"modulos"}
        - title: "â¬‡ï¸ Descargar PDF"
          payload: /ver_estado_estudiante{"accion":"descargar"}
        - title: "ğŸ  MenÃº"
          payload: /ir_menu_principal

  # ===============================
  # ğŸš« Estado NO autenticado
  # ===============================
  utter_estado_no_autenticado:
    - text: "ğŸš« No has iniciado sesiÃ³n, no puedo mostrar tu estado. Â¿Deseas autenticarte?"
      buttons:
        - title: "ğŸ”‘ Iniciar sesiÃ³n"
          payload: /iniciar_sesion
        - title: "â„¹ï¸ Ver instrucciones"
          payload: /ver_login_hint
        - title: "â¬…ï¸ MenÃº"
          payload: /ir_menu_principal

  # ====== MENÃš PRINCIPAL ======
  utter_menu_principal:
    - text: >
        ğŸ“š Â¡Estoy listo para ayudarte! Elige una opciÃ³n para continuar:
      buttons:
        - title: "ğŸ“ Ver estado acadÃ©mico"
          payload: /ver_estado_estudiante
        - title: "ğŸ“„ Consultar certificados"
          payload: /consultar_certificados
        - title: "ğŸ  MenÃº principal"
          payload: /ir_menu_principal
        - title: "ğŸ‘‹ Terminar conversaciÃ³n"
          payload: /terminar_conversacion

  # ====== GATE DE AUTENTICACIÃ“N ======
  utter_login_requerido:
    - text: >
        ğŸ” Para continuar con esta acciÃ³n necesito que inicies sesiÃ³n.
        Â¿Deseas iniciar ahora?
      buttons:
        - title: "âœ… SÃ­, iniciar sesiÃ³n"
          payload: /ir_menu_principal  # cÃ¡mbialo por tu intent real de login si lo tienes (p. ej. /iniciar_sesion)
        - title: "â¬…ï¸ Volver al menÃº"
          payload: /ir_menu_principal

  # ====== CONSULTAR CERTIFICADOS ======
  # Si ya viene el slot 'tipo_certificado', el form lo tomarÃ¡ y seguirÃ¡; si no, pregunta.
  utter_ask_tipo_certificado:
    - text: >
        Â¿QuÃ© documento necesitas? Selecciona una opciÃ³n:
      buttons:
        - title: "ğŸ–ï¸ Certificado"
          payload: /consultar_certificados{"tipo_certificado":"certificado"}
        - title: "ğŸ§¾ Constancia"
          payload: /consultar_certificados{"tipo_certificado":"constancia"}
        - title: "ğŸ“œ Historial"
          payload: /consultar_certificados{"tipo_certificado":"historial"}
        - title: "â¬…ï¸ MenÃº"
          payload: /ir_menu_principal

  utter_procesando_certificado:
    - text: >
        âœ… Perfecto, estoy generando tu **{tipo_certificado}**. Esto puede tardar unos segundosâ€¦

  utter_certificado_listo:
    - text: >
        ğŸ“ Tu **{tipo_certificado}** estÃ¡ listo. Â¿Deseas que lo envÃ­e al correo registrado o prefieres descargarlo aquÃ­?
      buttons:
        - title: "ğŸ“§ Enviar al correo"
          payload: /consultar_certificados{"accion":"enviar_email"}
        - title: "â¬‡ï¸ Descargar aquÃ­"
          payload: /consultar_certificados{"accion":"descargar"}
        - title: "â¬…ï¸ MenÃº"
          payload: /ir_menu_principal

  # ====== VER ESTADO ESTUDIANTE ======
  utter_mostrando_estado:
    - text: >
        ğŸ“Š AquÃ­ tienes tu estado acadÃ©mico actualizado.  
        Â¿Deseas ver el detalle por mÃ³dulo o descargar un resumen?
      buttons:
        - title: "ğŸ“š Ver detalle por mÃ³dulo"
          payload: /ver_estado_estudiante{"detalle":"modulos"}
        - title: "â¬‡ï¸ Descargar PDF"
          payload: /ver_estado_estudiante{"accion":"descargar"}
        - title: "â¬…ï¸ MenÃº"
          payload: /ir_menu_principal

  # ====== IR MENÃš PRINCIPAL ======
  utter_yendo_menu:
    - text: "ğŸ  Volviendo al menÃº principalâ€¦"
    - text: "Â¿QuÃ© deseas hacer?"
      buttons:
        - title: "ğŸ“ Ver estado acadÃ©mico"
          payload: /ver_estado_estudiante
        - title: "ğŸ“„ Consultar certificados"
          payload: /consultar_certificados
        - title: "ğŸ‘‹ Terminar conversaciÃ³n"
          payload: /terminar_conversacion

  # ====== TERMINAR CONVERSACIÃ“N (confirmaciÃ³n segura) ======
  utter_confirmar_cierre:
    - text: >
        Â¿Seguro que deseas cerrar la conversaciÃ³n? Si tienes algo en progreso, puedo guardarlo.
      buttons:
        - title: "âœ… SÃ­, terminar"
          payload: /affirm
        - title: "âŒ No, continuar"
          payload: /deny

  utter_cierre_confirmado:
    - text: "ğŸ‘‹ ConversaciÃ³n finalizada. Â¡Gracias por usar el Tutor Virtual!"

  utter_guardando_progreso:
    - text: "ğŸ’¾ Guardando tu progresoâ€¦"

  # ====== FALLBACK / DESAMBIGUACIÃ“N ======
  utter_fallback:
    - text: >
        ğŸ˜… No estoy seguro de haber entendido. Â¿Te refieres a alguna de estas opciones?
      buttons:
        - title: "ğŸ“ Ver estado acadÃ©mico"
          payload: /ver_estado_estudiante
        - title: "ğŸ“„ Consultar certificados"
          payload: /consultar_certificados
        - title: "ğŸ  MenÃº principal"
          payload: /ir_menu_principal
        - title: "ğŸ‘‹ Terminar conversaciÃ³n"
          payload: /terminar_conversacion

forms:
  certificado_form:
    required_slots:
      - tipo_certificado
    ignored_intents: [] 
login_form:
    required_slots:
    nombre_usuario:
      - type: from_text
        email:
      - type: from_text

# ============================================
# âš™ï¸ ACCIONES PERSONALIZADAS ZAJUNA ACADÃ‰MICAS
# ============================================
actions:
  - action_guardar_encuesta
  - action_registrar_feedback
  - action_finalizar_conversacion
  - action_estado_estudiante
  - action_ver_certificados
  - action_listar_certificados
  - action_tutor_asignado
  - action_set_encuesta_tipo
  - action_check_auth
  - action_registrar_encuesta
  - action_guardar_feedback
  - action_ofrecer_continuar_tema
  - action_preguntar_resolucion
  - action_ver_estado_estudiante
  - consultar_certificados
  - ver_estado_estudiante
  - ir_menu_principal
  - terminar_conversacion
  - fallback

    