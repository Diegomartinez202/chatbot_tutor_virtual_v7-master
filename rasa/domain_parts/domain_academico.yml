# ruta: rasa/domain_parts/domain_academico.yml
version: "3.1"

intents:
  - consultar_academico
  - consultar_certificados
  - ver_certificados_info
  - ver_estado_estudiante
  - ver_estado_estudiante_info
  - horarios_calendario
  - proceso_academico
  - proceso_academico_secundario
  - ir_menu_principal
  - terminar_conversacion
  - confirmar_autenticacion
  - negar_autenticacion
  - auth_login_cmd
  - ver_login_hint
  - affirm
  - deny
  - nlu_fallback

entities:
  - curso
  - certificado
  - tutor
  - encuesta_tipo
  - nombre
  - tipo_estado
  - email

slots:

  # ğŸ” Estado de autenticaciÃ³n (usado por rules)
  is_authenticated:
    type: bool
    influence_conversation: true
    initial_value: false
    mappings:
      - type: from_trigger_intent
        value: true
        intent: confirmar_autenticacion
      - type: from_trigger_intent
        value: false
        intent: negar_autenticacion

  curso:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: curso
      - type: from_text

  certificado:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: certificado
      - type: from_text

  tutor:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: tutor
      - type: from_text

  auth_token:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text

  encuesta_tipo:
    type: categorical
    values: ["positiva", "negativa", "neutra"]
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: encuesta_tipo
      - type: from_text

  nombre_usuario:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: nombre
      - type: from_text

  tipo_estado:
    type: categorical
    values: ["inscrito", "en_curso", "aprobado", "reprobado", "certificado", "pendiente"]
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: tipo_estado
      - type: from_text

responses:

  # ğŸ”¹ MenÃº principal acadÃ©mico
  utter_menu_academico:
    - text: "ğŸ“š MenÃº acadÃ©mico de Zajuna:"
      buttons:
        - title: "ğŸ“œ Ver certificados"
          payload: "/consultar_certificados"
        - title: "ğŸ§¾ Estado de estudiante"
          payload: "/ver_estado_estudiante"
        - title: "â¬…ï¸ Volver al menÃº principal"
          payload: "/ir_menu_principal"

  # ğŸ”¹ MenÃº principal general (ya existente en domain general; lo dejamos por si se importa aislado)
  utter_menu_principal:
    - text: |
        ğŸ‘‹ Â¡AquÃ­ tienes el menÃº principal de Tutor Virtual Zajuna!
        Selecciona una opciÃ³n para continuar:
      buttons:
        - title: "ğŸ“ Ver estado acadÃ©mico"
          payload: "/ver_estado_estudiante"
        - title: "ğŸ“œ Consultar certificados"
          payload: "/consultar_certificados"
        - title: "ğŸ› ï¸ Soporte tÃ©cnico"
          payload: "/solicitar_soporte"
        - title: "ğŸ” Iniciar sesiÃ³n Zajuna"
          payload: "/auth_login_cmd"
        - title: "âŒ Terminar conversaciÃ³n"
          payload: "/terminar_conversacion"

  # ğŸ” Solicitud de autenticaciÃ³n
  utter_pedir_autenticacion:
    - text: >
        ğŸ” Para consultar tus certificados o ver tu estado acadÃ©mico, necesito que inicies sesiÃ³n.
        Â¿Deseas iniciar ahora?
      buttons:
        - title: "âœ… SÃ­, iniciar sesiÃ³n"
          payload: "/auth_login_cmd"
        - title: "â“ Â¿CÃ³mo me autentico?"
          payload: "/ver_login_hint"
        - title: "â¬…ï¸ Volver al menÃº"
          payload: "/ir_menu_principal"

  # ğŸ“„ Certificados
  utter_certificados_listado:
    - text: "ğŸ“ AquÃ­ tienes tus certificados disponibles:\n{certificado}"
      buttons:
        - title: "Volver al menÃº acadÃ©mico"
          payload: "/consultar_academico"
        - title: "Ir al menÃº principal"
          payload: "/ir_menu_principal"

  # ğŸ“Š Estado
  utter_estado_estudiante_detalle:
    - text: "ğŸ“Š Estado actual del estudiante: {curso}"
      buttons:
        - title: "Volver al menÃº acadÃ©mico"
          payload: "/consultar_academico"
        - title: "Ir al menÃº principal"
          payload: "/ir_menu_principal"

  # ğŸ’¬ Encuesta y cierre
  utter_preguntar_continuar_menu:
    - text: "Â¿Deseas realizar otra consulta?"
      buttons:
        - title: "SÃ­, volver al menÃº principal"
          payload: "/ir_menu_principal"
        - title: "No, terminar conversaciÃ³n"
          payload: "/terminar_conversacion"

  utter_confirmar_cierre:
    - text: |
        ğŸ›‘ Â¿Deseas terminar la conversaciÃ³n?
        Puedo guardar tu progreso y retomarlo luego.
      buttons:
        - title: "âœ… SÃ­, terminar"
          payload: "/terminar_conversacion"
        - title: "â†©ï¸ No, continuar"
          payload: "/ir_menu_principal"

actions:
  - action_estado_estudiante
  - action_tutor_asignado
  - action_listar_certificados
  - action_ver_certificados
  - action_ingreso_zajuna
  - action_recuperar_contrasena
  - zajuna_get_certificados
  - zajuna_get_estado_estudiante
