version: "3.3"

intents:
  - terminar_conversacion
  - despedida
  - cancelar
  - confirmar_cierre
  - negar_cierre
  - ir_menu_principal
  - fallback

slots:
  session_activa:
    type: bool
    influence_conversation: true
    initial_value: true

  proceso_activo:
    type: text
    influence_conversation: true
    initial_value: null
    mappings:
      - type: custom

  encuesta_incompleta:
    type: bool
    influence_conversation: true
    initial_value: false

  confirmacion_cierre:
    type: text
    influence_conversation: true
    initial_value: null

responses:
  utter_confirmar_cierre_seguro:
    - text: >
        Parece que aÃºn tienes un proceso activo: **{proceso_activo}**.  
        Â¿Deseas cerrar la conversaciÃ³n de todos modos?
      buttons:
        - title: "SÃ­, cerrar de todas formas"
          payload: "/confirmar_cierre"
        - title: "No, continuar"
          payload: "/negar_cierre"

  utter_confirmar_cierre_con_autosave:
    - text: >
        DetectÃ© que tienes una **encuesta sin completar**.  
        Puedo guardarla automÃ¡ticamente antes de cerrar. Â¿Quieres hacerlo?
      buttons:
        - title: "SÃ­, guardar y cerrar"
          payload: "/confirmar_cierre"
        - title: "No, descartar encuesta"
          payload: "/negar_cierre"

  utter_confirmar_cierre:
    - text: "Â¿EstÃ¡s seguro que deseas terminar la conversaciÃ³n?"
      buttons:
        - title: "SÃ­, terminar"
          payload: "/confirmar_cierre"
        - title: "No, continuar"
          payload: "/negar_cierre"

  utter_despedida_final:
    - text: "Gracias por conversar conmigo. Tus datos se han guardado correctamente. Â¡Hasta pronto! ğŸ‘‹"

  utter_despedida_sin_guardar:
    - text: "Ok, se descartaron los datos pendientes. Â¡Hasta pronto! ğŸ‘‹"

  utter_cancelar_cierre:
    - text: "Perfecto ğŸ˜Š, continuemos. Â¿En quÃ© mÃ¡s puedo ayudarte?"

  utter_fallback:
    - text: "Disculpa, no entendÃ­ eso. Â¿Deseas salir del chat o volver al menÃº principal?"
      buttons:
        - title: "Salir del chat"
          payload: "/terminar_conversacion"
        - title: "MenÃº principal"
          payload: "/ir_menu_principal"

actions:
  - action_verificar_proceso_activo_autosave
  - action_guardar_encuesta_incompleta
  - action_confirmar_cierre_autosave
  - action_cancelar_cierre
