version: "3.1"

intents:
  - ver_estado_estudiante
  - estado_estudiante
  - consultar_certificados
  - auth_login_cmd
  - deny
  - saludo
  - auth_login_cmd
  - deny
  - saludo
  - ver_login_hint          
  - recuperar_contrasena
slots:
  is_authenticated:
    type: bool
    influence_conversation: true
    initial_value: false
  zajuna_base_url:
    type: text
    influence_conversation: false
    initial_value: "https://zajuna.edu"
responses:
  # âœ… MenÃº principal con botones
  utter_menu_principal:
    - text: "Â¡Hola! Soy tu asistente Zajuna ğŸ‘‹. Â¿QuÃ© deseas hacer?"
      buttons:
        - title: "ğŸ“ Ver estado acadÃ©mico"
          payload: "/ver_estado_estudiante"
        - title: "ğŸ“œ Consultar certificados"
          payload: "/consultar_certificados"
        - title: "ğŸ” Iniciar sesiÃ³n"
          payload: "/auth_login_cmd"
        - title: "âŒ Terminar conversaciÃ³n"
          payload: "/terminar_conversacion"

  # ğŸ”’ PeticiÃ³n de autenticaciÃ³n (con CTA)
  utter_pedir_autenticacion:
    - text: "ğŸ”’ Para continuar necesito que inicies sesiÃ³n. Â¿Quieres autenticarte ahora?"
      buttons:
        - title: "ğŸ”‘ Iniciar sesiÃ³n Zajuna"
          payload: "/auth_login_cmd"
        - title: "âŒ No, luego"
          payload: "/deny"

  # Variante explÃ­cita de login requerido (usada en reglas)
  utter_login_requerido:
    - text: "Para ver esta informaciÃ³n debes iniciar sesiÃ³n en Zajuna."
      buttons:
        - title: "ğŸ”‘ Iniciar sesiÃ³n ahora"
          payload: "/auth_login_cmd"
        - title: "ğŸ“‹ Ver guÃ­a de login"
          payload: "/ver_login_hint"
        - title: "â†©ï¸ Volver al menÃº"
          payload: "/saludo"

  # ğŸ§¾ Estado mostrado (si ya estÃ¡s autenticado y la action resuelve)
  utter_estado_mostrado:
    - text: "ğŸ“Š Tu estado acadÃ©mico actual es: {estado}."
      buttons:
        - title: "ğŸ“œ Ver certificados"
          payload: "/consultar_certificados"
        - title: "ğŸ  MenÃº principal"
          payload: "/saludo"

  utter_certificado_listado:
    - text: |
        ğŸ“‘ **Tus certificados**
        {certificados_md}

        Â¿QuÃ© deseas hacer ahora?
      buttons:
        - title: "â¬‡ï¸ Descargar certificados"
          payload: "/ver_certificados_info"
        - title: "ğŸ  MenÃº principal"
          payload: "/saludo"

  # ğŸ§© ConfirmaciÃ³n de envÃ­o (si tu action envÃ­a por email)
  utter_confirmacion_consulta:
    - text: "âœ… He enviado tus certificados al correo registrado."

  # ğŸ§¸ Despedida profesional (por si no estaba en otro domain part)
  utter_despedida_profesional:
    - text: "ğŸ‘‹ Gracias por usar el asistente Zajuna. Â¡Que tengas un excelente dÃ­a! ğŸŒŸ"
  # ğŸ‘‰ NUEVO: guÃ­a con deep-links
  utter_login_hint:
    - text: |
        ğŸ” **CÃ³mo iniciar sesiÃ³n en Zajuna**
        1) Abre el portal: {zajuna_base_url}/login  
        2) Ingresa tu usuario/correo y contraseÃ±a.  
        3) Si olvidaste la clave, usa **â€œÂ¿OlvidÃ© mi contraseÃ±a?â€**.

        Atajos:
        â€¢ Inicio de sesiÃ³n: {zajuna_base_url}/login  
        â€¢ Registro: {zajuna_base_url}/register  
        â€¢ Recuperar contraseÃ±a: {zajuna_base_url}/password/reset
      buttons:
        - title: "ğŸ”‘ Ir a Iniciar sesiÃ³n"
          payload: "/auth_login_cmd"
        - title: "ğŸ†˜ Recuperar contraseÃ±a"
          payload: "/recuperar_contrasena"
        - title: "ğŸ  MenÃº"
          payload: "/saludo"

  # ğŸ‘‰ NUEVO: CTA de recuperaciÃ³n
  utter_recuperar_acceso_cta:
    - text: |
        ğŸ†˜ **RecuperaciÃ³n de acceso**
        1) Ve a: {zajuna_base_url}/password/reset  
        2) Ingresa tu correo registrado y confirma.  
        3) Revisa tu bandeja de entrada (y spam).  
        4) Sigue el enlace para crear una nueva contraseÃ±a.

        Â¿Listo para continuar luego?
      buttons:
        - title: "âœ… Ya recuperÃ© mi acceso"
          payload: "/auth_login_cmd"
        - title: "ğŸ  MenÃº"
          payload: "/saludo"