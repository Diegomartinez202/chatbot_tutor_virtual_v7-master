version: "3.1"

intents:
  - solicitar_soporte
  - recuperar_contrasena
  - provide_email
  - affirm
  - deny
  - iniciar_encuesta
  - necesita_humano
  - fallback
  - iniciar_sesion
  - estado_estudiante
  - ver_certificados
  - confirmar_autenticacion
  - enviar_email_recuperacion
  - ingreso_zajuna
  - enviar_numero
  - provide_email
  - pedir_correo
  - pedir_email
  - enviar_telefono
  - abrir_chat_autenticado
  - auth_login_cmd
  - ver_login_hint
  - cambiar_idioma_espanol
  - cambiar_idioma_ingles
  - enviar_credenciales
  

entities:
  - email
  - nombre
  - mensaje
  - password
  - phone
  - motivo_soporte
  - prefer_contacto
  - necesita_humano
  - encuesta_tipo

slots:

  nombre:
    type: text
    influence_conversation: false
  mensaje:
    type: text
    influence_conversation: false
  encuesta_respuesta:
    type: text
    influence_conversation: false

  has_token:
    type: bool
    influence_conversation: true
    initial_value: false
  auth_token:
    type: text
    influence_conversation: false
  usuario:
    type: text
    influence_conversation: false

  is_authenticated:
    type: bool
    influence_conversation: true
    initial_value: false
    mappings:
      - type: from_intent
        intent: confirmar_autenticacion
        value: true
      - type: from_intent
        intent: deny
        value: false

  auth_email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
        conditions:
          - active_loop: auth_login_form
            requested_slot: auth_email

  auth_password:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: auth_login_form
            requested_slot: auth_password

  recovery_email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
        conditions:
          - active_loop: password_recovery_form
            requested_slot: recovery_email

  email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
        conditions:
          - active_loop: auth_login_form
            requested_slot: email
          - active_loop: password_recovery_form
            requested_slot: email

  password:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: password
      - type: from_text
        conditions:
          - active_loop: auth_login_form
            requested_slot: password

  phone:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: phone
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: phone

  motivo_soporte:
    type: categorical
    values: ["acceso", "calificaciones", "certificados", "tecnico", "otro"]
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: motivo_soporte
      - type: from_intent
        intent: solicitar_soporte
        value: "otro"
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: motivo_soporte

  prefer_contacto:
    type: categorical
    values: ["email", "whatsapp", "ninguno"]
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: prefer_contacto
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: prefer_contacto

  soporte_mensaje:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: soporte_mensaje

  necesita_humano:
    type: bool
    influence_conversation: true
    initial_value: false
    mappings:
      - type: from_intent
        intent: necesita_humano
        value: true
      - type: from_intent
        intent: deny
        value: false
      - type: from_entity
        entity: necesita_humano

  encuesta_activa:
    type: bool
    influence_conversation: true
    initial_value: false
    mappings:
      - type: from_intent
        intent: iniciar_encuesta
        value: true

  encuesta_tipo:
    type: categorical
    values: ["satisfaccion", "soporte", "otro"]
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: encuesta_tipo
      - type: from_text
        conditions:
          - active_loop: encuesta_satisfaccion_form
            requested_slot: encuesta_tipo

forms:
  auth_login_form:
    required_slots:
      - email
      - password

  password_recovery_form:
    required_slots:
      - email

  soporte_form:
    required_slots:
      - motivo_soporte
      - soporte_mensaje
      - prefer_contacto
      - phone

  encuesta_satisfaccion_form:
    required_slots:
      - encuesta_tipo

  recovery_form:
    required_slots:
      - email

responses:
  utter_saludo:
    - text: "Â¡Hola! ğŸ‘‹ Â¿En quÃ© puedo ayudarte hoy?"

  utter_ofrecer_continuar:
    - text: "Â¿Deseas continuar con este tema o enviar un soporte?"
      buttons:
        - title: "SÃ­, continuar"
          payload: "/affirm"
        - title: "No, enviar soporte"
          payload: "/deny"

  utter_confirmacion_recuperacion:
    - text: "ğŸ“¬ Te enviÃ© un enlace de recuperaciÃ³n a tu correo."

  utter_espera_agente:
    - text: "ğŸ§‘â€ğŸ’» Te conecto con un agente humano, por favor espera..."

  utter_agradecimiento_encuesta:
    - text: "âœ… Gracias por completar la encuesta, tu opiniÃ³n es muy valiosa."

  utter_preguntar_resolucion:
    - text: "Â¿Se resolviÃ³ tu problema con el soporte recibido?"
      buttons:
        - title: "SÃ­"
          payload: "/affirm"
        - title: "No"
          payload: "/deny"

  utter_need_auth:
    - text: "âš ï¸ Para realizar esta acciÃ³n necesitas iniciar sesiÃ³n."
      buttons:
        - title: "Iniciar sesiÃ³n"
          payload: "/ingreso_zajuna"
        - title: "Cancelar"
          payload: "/deny"

  utter_bienvenida:
    - text: "Bienvenido/a, has iniciado sesiÃ³n correctamente. ğŸ˜ƒ"

  utter_fallback:
    - text: "Lo siento, no entendÃ­ tu mensaje. Por favor intenta de nuevo o escribe 'ayuda'."

  utter_confirmar_envio_correo:
    - text: "Listo, he enviado el correo de recuperaciÃ³n."

  # ====== AUTENTICACIÃ“N ======
  utter_pedir_autenticacion:
    - text: "ğŸ” Para continuar necesito que te autentiques. Â¿Deseas iniciar sesiÃ³n?"
      buttons:
        - title: "âœ… SÃ­, iniciar sesiÃ³n"
          payload: /confirmar_autenticacion
        - title: "ğŸ”‘ Ya tengo cuenta"
          payload: /enviar_credenciales
        - title: "â“ Â¿CÃ³mo me autentico?"
          payload: /ver_login_hint
        - title: "â¬…ï¸ MenÃº"
          payload: /ir_menu_principal

  utter_ask_email:
    - text: "ğŸ“§ Escribe tu correo institucional (ej. nombre@zajuna.edu.co)."
      buttons:
        - title: "Usar correo guardado"
          payload: /enviar_credenciales{"email":"{email}"}
    - text: "Por favor indÃ­came el correo con el que estÃ¡s registrado."

  utter_ask_password:
    - text: "ğŸ”’ Ingresa tu contraseÃ±a (no la compartirÃ©)."
    - text: "Escribe tu contraseÃ±a para continuar."

  utter_auth_ok:
    - text: "âœ… AutenticaciÃ³n correcta. Â¿QuÃ© deseas consultar?"
      buttons:
        - title: "ğŸ“ Estado acadÃ©mico"
          payload: /estado_estudiante
        - title: "ğŸ“„ Certificados"
          payload: /consultar_certificados
        - title: "ğŸ  MenÃº"
          payload: /ir_menu_principal

  utter_auth_fail:
    - text: "âš ï¸ No pude iniciar sesiÃ³n con esos datos. Â¿Intentamos de nuevo o recuperamos tu contraseÃ±a?"
      buttons:
        - title: "ğŸ” Reintentar"
          payload: /enviar_credenciales
        - title: "ğŸ§· Recuperar contraseÃ±a"
          payload: /recuperar_contrasena
        - title: "ğŸ‘¤ Hablar con humano"
          payload: /necesita_humano


  # ====== SOPORTE ======
  utter_solicitar_soporte_intro:
    - text: "ğŸ› ï¸ CuÃ©ntame tu caso y te ayudo o te conecto con un agente."
      buttons:
        - title: "ğŸ”“ Acceso / Login"
          payload: /solicitar_soporte{"motivo_soporte":"acceso"}
        - title: "ğŸ§¾ Certificados"
          payload: /solicitar_soporte{"motivo_soporte":"certificados"}
        - title: "ğŸ“Š Calificaciones"
          payload: /solicitar_soporte{"motivo_soporte":"calificaciones"}
        - title: "ğŸ’» Problema tÃ©cnico"
          payload: /solicitar_soporte{"motivo_soporte":"tecnico"}
        - title: "ğŸ“ Otro"
          payload: /solicitar_soporte{"motivo_soporte":"otro"}

  utter_ask_motivo_soporte:
    - text: "Â¿CuÃ¡l es el motivo principal de tu solicitud?"
      buttons:
        - title: "ğŸ”“ Acceso"
          payload: /informar_slot{"motivo_soporte":"acceso"}
        - title: "ğŸ§¾ Certificados"
          payload: /informar_slot{"motivo_soporte":"certificados"}
        - title: "ğŸ“Š Calificaciones"
          payload: /informar_slot{"motivo_soporte":"calificaciones"}
        - title: "ğŸ’» TÃ©cnico"
          payload: /informar_slot{"motivo_soporte":"tecnico"}
        - title: "ğŸ“ Otro"
          payload: /informar_slot{"motivo_soporte":"otro"}

  utter_ask_soporte_mensaje:
    - text: "ğŸ“£ Describe brevemente el problema (mÃ¡x. 250 caracteres)."

  utter_ask_prefer_contacto:
    - text: "Â¿CÃ³mo prefieres que te contactemos?"
      buttons:
        - title: "ğŸ“§ Correo"
          payload: /informar_slot{"prefer_contacto":"email"}
        - title: "ğŸ’¬ WhatsApp"
          payload: /informar_slot{"prefer_contacto":"whatsapp"}
        - title: "ğŸš« Ninguno"
          payload: /informar_slot{"prefer_contacto":"ninguno"}

  utter_ask_phone:
    - text: "ğŸ“± DÃ©jame un nÃºmero de WhatsApp con indicativo (ej. +57 3xx xxx xxxx)."

  utter_soporte_registrado:
    - text: "ğŸ“ Tu caso fue registrado. Te contactaremos por {prefer_contacto}. Â¿Deseas hablar con un agente ahora?"
      buttons:
        - title: "ğŸ‘¤ SÃ­, un agente"
          payload: /necesita_humano
        - title: "No, gracias"
          payload: /ir_menu_principal

  # ====== DERIVACIÃ“N A HUMANO / CONTROL AFFIRM/DENY ======
  utter_ofrecer_humano:
    - text: "Â¿Te conecto con un agente humano?"
      buttons:
        - title: "âœ… SÃ­"
          payload: /affirm
        - title: "âŒ No"
          payload: /deny

  utter_derivando_humano:
    - text: "ğŸ‘¤ Te conectarÃ© con un agente. Por favor, espera un momentoâ€¦"

  utter_derivacion_cancelada:
    - text: "ğŸ‘Œ Perfecto, seguimos aquÃ­. Â¿QuÃ© mÃ¡s deseas hacer?"
      buttons:
        - title: "ğŸ  MenÃº"
          payload: /ir_menu_principal
        - title: "ğŸ› ï¸ Soporte"
          payload: /solicitar_soporte

  # ====== ENCUESTA / INICIO ======
  utter_encuesta_inicio:
    - text: "ğŸ“ Iniciemos una breve encuesta. Â¿Sobre quÃ© tema?"
      buttons:
        - title: "ğŸ™‚ SatisfacciÃ³n"
          payload: /iniciar_encuesta{"encuesta_tipo":"satisfaccion"}
        - title: "ğŸ› ï¸ Soporte"
          payload: /iniciar_encuesta{"encuesta_tipo":"soporte"}
        - title: "Otro"
          payload: /iniciar_encuesta{"encuesta_tipo":"otro"}


  # === EnvÃ­o de recuperaciÃ³n ===
  utter_recuperacion_enviada:
    - text: "ğŸ“§ Te enviÃ© un correo con instrucciones para restablecer tu contraseÃ±a. Revisa tu bandeja de entrada (y spam)."
      buttons:
        - title: "ğŸ” Volver a iniciar sesiÃ³n"
          payload: "/auth_login_cmd"
        - title: "ğŸ  MenÃº principal"
          payload: "/ir_menu_principal"
        - title: "âœ… Ya recuperÃ©"
          payload: /confirmar_autenticacion
        - title: "âŒ No llegÃ³ el correo"
          payload: /deny
        - title: "ğŸ  MenÃº"
          payload: /ir_menu_principal
  # === Ofrecer soporte rÃ¡pido (confirmaciÃ³n) ===
  utter_soporte_confirmar:
    - text: "ğŸ› ï¸ Â¿Deseas que abra un caso de soporte con un asesor?"
      buttons:
        - title: "SÃ­, por favor"
          payload: "/affirm"
        - title: "No, gracias"
          payload: "/deny"

  # === Handoff (opcional visual) ===
  utter_handoff_iniciado:
    - text: "ğŸ¤ Te conecto con un asesor humano. Este chat seguirÃ¡ disponible para actualizarte."

  # === Pedidos de slots para forms (Rasa 3.1) ===
  utter_ask_auth_email:
    - text: "ğŸ“§ IndÃ­came tu correo de Zajuna."
  utter_ask_auth_password:
    - text: "ğŸ”‘ Ahora tu contraseÃ±a."
  utter_ask_recovery_email:
    - text: "ğŸ“§ Â¿CuÃ¡l es el correo asociado a tu cuenta para enviarte el enlace de recuperaciÃ³n?"
actions:
  - action_ofrecer_continuar_tema
  - action_enviar_soporte
  - action_soporte_submit
  - action_ingreso_zajuna
  - action_enviar_correo
  - action_derivar_y_registrar_humano
  - action_conectar_humano
  - action_preguntar_resolucion
  - action_registrar_encuesta
  - action_set_authenticated_true
  - action_estado_estudiante
  - action_ver_certificados
  - action_recuperar_contrasena
  - action_sync_auth_from_metadata
  - action_check_auth_estado
  - action_mark_authenticated
  - action_necesita_auth
  - action_submit_recovery
  - action_set_encuesta_tipo
  - action_iniciar_sesion
  - action_enviar_credenciales
  - action_confirmar_autenticacion
  - estado_estudiante
  - action_recuperar_contrasena
  - action_enviar_email_recuperacion
  - action_auth_login_cmd
  - action_abrir_chat_autenticado
  - action_ver_login_hint
  - action_action_set_authenticated_true
  - action_enviar_correo_recuperacion
 
session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true