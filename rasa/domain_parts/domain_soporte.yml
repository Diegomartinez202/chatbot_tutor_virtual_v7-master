# ruta: rasa/domain_parts/domain_soporte.yml
version: "3.1"

intents:
  - solicitar_soporte
  - soporte_tecnico
  - problema_no_ingreso
  - pantalla_blanca
  - error_actividad
  - otro_problema_tecnico
  - necesita_humano
  - escalar_humano
  - confirmacion_escalar_humano
  - negar_escalar
  - respuesta_satisfecho
  - respuesta_insatisfecho
  - enviar_correo_tutor
  - continuar_consulta
  - terminar_conversacion
  - ver_link_soporte
  - ver_soporte_creado_info

entities:
  - nombre
  - email
  - mensaje
  - problema

slots:
  nombre:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: nombre
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: nombre

  email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: email

  mensaje:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: mensaje
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: mensaje

  problema:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: problema
      - type: from_text

responses:

  # MenÃº/arranque de soporte
  utter_solicitar_soporte_intro:
    - text: "ğŸ› ï¸ Vamos a crear un ticket de soporte. Te harÃ© 3 preguntas rÃ¡pidas."

  utter_menu_soporte:
    - text: "ğŸ› ï¸ MenÃº de soporte:"
      buttons:
        - title: "ğŸ“ Reportar un problema"
          payload: "/solicitar_soporte"
        - title: "â¬…ï¸ Volver al menÃº principal"
          payload: "/ir_menu_principal"

  # Preguntas del form (utter_ask_<slot>)
  utter_ask_nombre:
    - text: "Â¿CuÃ¡l es tu nombre?"

  utter_ask_email:
    - text: "Â¿CuÃ¡l es tu correo electrÃ³nico?"

  utter_ask_mensaje:
    - text: "CuÃ©ntame brevemente tu problema o solicitud."

  # Confirmaciones / errores de soporte
  utter_soporte_registrado:
    - text: "ğŸ« Tu ticket de soporte fue creado correctamente."

  utter_soporte_error:
    - text: "âš ï¸ No pude registrar el soporte. Intentaremos de nuevo."

  # Encuesta
  utter_preguntar_satisfaccion:
    - text: "Â¿Quedaste satisfecho con la atenciÃ³n recibida?"
      buttons:
        - title: "SÃ­, satisfecho ğŸ˜„"
          payload: "/respuesta_satisfecho"
        - title: "No, insatisfecho ğŸ˜”"
          payload: "/respuesta_insatisfecho"

  utter_encuesta_positiva:
    - text: "Â¡Nos alegra que estÃ©s satisfecho! âœ…"

  utter_encuesta_negativa:
    - text: "Lamentamos que tu experiencia no haya sido la mejor. Podemos contactar a tu tutor para ayudarte."

  utter_ofrecer_contacto_tutor:
    - text: "Â¿Deseas contactar a tu tutor?"
      buttons:
        - title: "âœ‰ï¸ Enviar correo al tutor"
          payload: "/enviar_correo_tutor"
        - title: "â¬…ï¸ Volver al menÃº principal"
          payload: "/ir_menu_principal"

  # DerivaciÃ³n a humano
  utter_ofrecer_humano:
    - text: "Â¿Quieres que te conecte con un agente humano?"

  utter_derivando_humano:
    - text: "Te estoy conectando con un agente humanoâ€¦"

  utter_derivacion_cancelada:
    - text: "Perfecto, continuamos por aquÃ­. Â¿En quÃ© mÃ¡s te ayudo?"

  # Correo a tutor
  utter_correo_enviado:
    - text: "ğŸ“¬ EnviÃ© un mensaje a tu tutor. Te responderÃ¡ al correo registrado."

actions:
  - validate_soporte_form
  - action_enviar_soporte
  - action_soporte_submit
  - action_derivar_y_registrar_humano
  - action_conectar_humano
  - action_enviar_correo_tutor

forms:
  soporte_form:
    required_slots:
      - nombre
      - email
      - mensaje
