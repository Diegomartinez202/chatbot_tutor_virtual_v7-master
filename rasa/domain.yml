version: "3.1"

intents:
  # Intents principales del asistente
  - saludo
  - explorar_temas
  - ingreso_zajuna
  - recuperar_contrasena
  - otro_problema_acceso
  - proceso_academico
  - ver_certificados
  - tutor_asignado
  - horarios_calendario
  - soporte_tecnico
  - problema_no_ingreso
  - pantalla_blanca
  - error_actividad
  - otro_problema_tecnico
  - escalar_humano
  - confirmacion_escalar_humano
  - negar_escalar
  - estado_estudiante
  - cambiar_idioma_ingles
  - cambiar_idioma_espanol
  - inscribirme
  - enviar_correo
  - auth_login

  # Intents de fallback y confirmaci√≥n
  - affirm
  - deny
  - fallback
  - enviar_soporte
  - enviar_telefono
  - enviar_cedula
  - enviar_numero
  - enviar_url

  # Intents dedicados (para reglas placeholder, evitan choques)
  - pedir_correo
  - pedir_email
  - pedir_nombre
  - pedir_mensaje
  - estado_estudiante_info
  - necesita_auth
  - soporte_confirmar
  - soporte_error
  - auth_login_cmd
  - enviar_soporte_directo

entities:
  - email
  - telefono
  - cedula
  - numero
  - url

slots:
  email:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: email
      - type: from_text

  nombre:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text

  mensaje:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text

  telefono:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: telefono

  cedula:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: cedula

  numero:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: numero

  url:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: url

forms:
  soporte_form:
    required_slots:
      - nombre
      - email
      - mensaje
  recovery_form:
    required_slots:
      - email

responses:
  # --- Saludo inicial ---
  utter_saludo:
    - text: "¬°Hola! Soy tu asistente Zajuna ü§ñ. ¬øC√≥mo te ayudo hoy?"
    - text: "Hola! ¬øEn qu√© puedo ayudarte hoy?"
      buttons:
        - title: "Explorar temas"
          payload: "/explorar_temas"
        - title: "Ingreso a Zajuna"
          payload: "/ingreso_zajuna"
        - title: "Mis cursos y contenidos"
          payload: "/explorar_temas"
        - title: "Proceso acad√©mico / administrativo"
          payload: "/proceso_academico"
        - title: "Soporte t√©cnico"
          payload: "/soporte_tecnico"

  # --- Cursos ---
  utter_cursos_carousel:
    - custom:
        cards:
          - title: "Excel B√°sico"
            subtitle: "20h - Virtual"
            image: "https://via.placeholder.com/300x160?text=Excel"
            buttons:
              - title: "Inscribirme"
                payload: "/inscribirme"
          - title: "Soldadura MIG"
            subtitle: "40h - Presencial"
            image: "https://via.placeholder.com/300x160?text=Soldadura"
            buttons:
              - title: "Inscribirme"
                payload: "/inscribirme"
          - title: "Programaci√≥n Web"
            subtitle: "60h - Virtual"
            image: "https://via.placeholder.com/300x160?text=Web"
            buttons:
              - title: "Inscribirme"
                payload: "/inscribirme"

  utter_cursos_recomendados:
    - text: "Aqu√≠ tienes algunos cursos que podr√≠an interesarte:"
      buttons:
        - title: "Python B√°sico ‚Äì Ago 2025"
          payload: "/inscribirme"
        - title: "IA Educativa ‚Äì Sep 2025"
          payload: "/inscribirme"

  # --- Problemas de acceso ---
  utter_preguntar_problema_acceso:
    - text: "Entiendo. ¬øTienes problemas de acceso? ¬øDeseas recuperar tu contrase√±a?"
      buttons:
        - title: "S√≠, recuperar contrase√±a"
          payload: "/recuperar_contrasena"
        - title: "No, otro problema"
          payload: "/otro_problema_acceso"

  utter_pedir_correo:
    - text: "Por favor, dime tu correo para enviarte el enlace de recuperaci√≥n."

  utter_confirmar_recuperacion:
    - text: "Perfecto. Revisa tu bandeja de entrada."

  # --- Men√∫ proceso acad√©mico ---
  utter_menu_proceso_academico:
    - text: "¬øSobre qu√© deseas informaci√≥n?"
      buttons:
        - title: "Tutor asignado"
          payload: "/tutor_asignado"
        - title: "Certificados"
          payload: "/ver_certificados"
        - title: "Horarios y calendario"
          payload: "/horarios_calendario"

  utter_certificados_info:
    - text: |
        Python B√°sico ‚Äì Nov 2024
        IA Educativa ‚Äì Ene 2025
      buttons:
        - title: "Descargar todos"
          payload: "/ver_certificados"
        - title: "Ver detalles"
          payload: "/ver_certificados"

  utter_tutor_asignado:
    - text: |
        Tu tutor actual es:
        Nombre: Prof. Ana Mar√≠a Restrepo
        Email: ana.restrepo@zajuna.edu
        Horario: Lun y Mi√© 10:00 - 12:00
      buttons:
        - title: "Ver disponibilidad"
          payload: "/tutor_asignado"
        - title: "Enviar mensaje"
          payload: "/tutor_asignado"

  # --- Soporte t√©cnico ---
  utter_soporte_tecnico:
    - text: "Entiendo. Vamos a tomar tus datos para ayudarte mejor."

  utter_estado_estudiante:
    - text: "Est√°s activo para el periodo acad√©mico 2025-2."

  # --- Cambio de idioma ---
  utter_cambio_idioma_ingles:
    - text: "Sure! Let's switch to English. You can ask me anything about your academic process or technical issues."

  utter_cambio_idioma_espanol:
    - text: "Volvamos a Espa√±ol."

  # --- Escalamiento humano ---
  utter_escalar_humano:
    - text: "¬øQuieres que te comunique con un agente humano?"
      buttons:
        - title: "S√≠, por favor"
          payload: "/confirmacion_escalar_humano"
        - title: "No, seguir con bot"
          payload: "/negar_escalar"

  utter_confirmar_escalado:
    - text: "Te estoy conectando con un agente humano, por favor espera..."

  utter_gracias_continuar:
    - text: "Perfecto, sigamos aqu√≠ en el chat."

  # --- Inscripciones ---
  utter_confirmacion_inscripcion:
    - text: "Est√°s inscrito al curso. Te enviaremos confirmaci√≥n por correo."

  # --- Fallback ---
  utter_default:
    - text: "No entend√≠ eso. ¬øPodr√≠as reformularlo?"

  # --- Prompts del soporte_form (utter_ask_<slot>) ---
  utter_ask_nombre:
    - text: "¬øCu√°l es tu nombre completo?"
  utter_ask_email:
    - text: "¬øCu√°l es tu correo de contacto?"
  utter_ask_mensaje:
    - text: "Cu√©ntame brevemente el problema t√©cnico (m√°x. 5000 caracteres)."

  utter_soporte_form_ok:
    - text: "Gracias. Estoy registrando tu solicitud..."

  utter_soporte_resumen:
    - text: |
        Gracias {nombre}. Voy a crear un ticket con:
        - Email: {email}
        - Mensaje: "{mensaje}"

  utter_soporte_creado:
    - text: "Ticket creado correctamente. Te enviaremos novedades a tu correo."

  utter_soporte_error:
    - text: "Ocurri√≥ un error al crear el ticket. Intenta de nuevo en unos minutos."

  # --- Autenticaci√≥n requerida ---
  utter_need_auth:
    - text: "Necesitas iniciar sesi√≥n para ver esta informaci√≥n."
      buttons:
        - title: "Iniciar sesi√≥n"
          payload: "/auth_login"
    - custom:
        type: "auth_needed"
        message: "Necesitas iniciar sesi√≥n para continuar."

  # --- Confirmaci√≥n soporte directo ---
  utter_soporte_confirm:
    - text: "Listo. He enviado tu solicitud de soporte. Te contactaremos al correo indicado."

  # --- Eco de entidades capturadas ---
  utter_enviar_correo:
    - text: "Perfecto, he registrado tu correo: {email}"
  utter_enviar_telefono:
    - text: "He guardado tu tel√©fono: {telefono}"
  utter_enviar_cedula:
    - text: "Tu c√©dula qued√≥ registrada: {cedula}"
  utter_enviar_numero:
    - text: "N√∫mero recibido: {numero}"
  utter_enviar_url:
    - text: "He registrado el enlace: {url}"

  utter_fallback:
    - text: "Lo siento, no entend√≠. ¬øPuedes repetirlo?"

actions:
  - action_enviar_correo
  - action_conectar_humano
  - action_soporte_submit
  - action_enviar_soporte
  - validate_soporte_form
  - validate_recovery_form
  - action_check_auth
  - action_health_check

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true