version: "3.1"

intents:
  - abrir_chat_autenticado
  - affirm
  - auth_login_cmd
  - cambiar_idioma_espanol
  - cambiar_idioma_ingles
  - confirmar_recuperacion
  - deny
  - enviar_cedula
  - enviar_correo
  - enviar_numero
  - enviar_soporte
  - enviar_soporte_directo
  - enviar_telefono
  - enviar_url
  - escalar_humano
  - explorar_temas
  - horarios_calendario
  - ingreso_zajuna
  - inscribirme
  - nlu_fallback
  - necesita_auth
  - otro_problema_acceso
  - otro_problema_tecnico
  - pedir_correo
  - pedir_email
  - pedir_mensaje
  - pedir_nombre
  - pantalla_blanca
  - problema_no_ingreso
  - proceso_academico
  - recuperar_contrasena
  - saludo
  - soporte_ava_directo
  - soporte_confirmar
  - soporte_error
  - soporte_tecnico
  - ver_card_demo
  - ver_catalogo
  - ver_certificados_info
  - ver_confirmar_recuperacion_info
  - ver_error_actividad_info
  - ver_estado_estudiante_info
  - ver_link_soporte
  - ver_login_hint
  - ver_pregunta_acceso
  - ver_soporte_creado_info
  - ver_soporte_tecnico_info
  - ver_tutor_asignado_info
  - error_actividad
  - encuesta_satis_yes
  - encuesta_satis_no
  - problema_resuelto_si
  - problema_resuelto_no
  - confirmacion_escalar_humano
  - negar_escalar
  - proceso_academico_secundario
entities:
  - nombre
  - email
  - mensaje

slots:
  has_token:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
      - type: custom   # lo setea action_sync_auth_from_metadata

  is_authenticated:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: abrir_chat_autenticado
        value: true

  nombre:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: nombre
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: nombre

  email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: email
          - active_loop: recovery_form
            requested_slot: email

  mensaje:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: mensaje
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: mensaje

responses:

  utter_affirm:
    - text: "Â¡Perfecto! Continuemos."

  utter_deny:
    - text: "Entendido. Â¿Quieres volver al menÃº principal?"

  utter_fallback:
    - text: "No te entendÃ­ bien ğŸ¤”. Â¿Puedes reformularlo o elegir una opciÃ³n del menÃº?"

  # ÃšNICA respuesta estÃ¡ndar para TODO lo que requiere login (con variantes)
  utter_need_auth:
    - text: |
        Para ver esta informaciÃ³n necesitas iniciar sesiÃ³n en Zajuna.
        Pasos:
        1) Entra a https://zajuna.edu/login
        2) Inicia sesiÃ³n con tu usuario y contraseÃ±a
        3) Vuelve aquÃ­ y presiona Â«âœ… Ya iniciÃ© sesiÃ³nÂ»
      buttons:
        - title: "ğŸ” Ir a Zajuna"
          type: web_url
          url: "https://zajuna.edu/login"
        - title: "âœ… Ya iniciÃ© sesiÃ³n"
          payload: /abrir_chat_autenticado
    - text: |
        Esta opciÃ³n requiere autenticaciÃ³n en Zajuna.
        1) Abre https://zajuna.edu/login
        2) Ingresa tus credenciales
        3) Presiona Â«âœ… Ya iniciÃ© sesiÃ³nÂ» para continuar
      buttons:
        - title: "ğŸ” Iniciar sesiÃ³n"
          type: web_url
          url: "https://zajuna.edu/login"
        - title: "âœ… Ya iniciÃ© sesiÃ³n"
          payload: /abrir_chat_autenticado

  utter_necesita_auth:
    - text: |
        Para ver esta informaciÃ³n necesitas iniciar sesiÃ³n en Zajuna.
        1) Ve a https://zajuna.edu/login, inicia sesiÃ³n y regresa aquÃ­.
      buttons:
        - title: "ğŸ” Ir a Zajuna"
          type: web_url
          url: "https://zajuna.edu/login"
        - title: "âœ… Ya iniciÃ© sesiÃ³n"
          payload: /abrir_chat_autenticado

  utter_ingreso_zajuna_instrucciones:
    - text: "Para ingresar a Zajuna: 1) Pulsa **Iniciar sesiÃ³n** 2) Autoriza en la ventana 3) Regresa al chat (se sincroniza automÃ¡ticamente)."

  utter_login_hint:
    - text: "Si ya iniciaste sesiÃ³n, escribe de nuevo la consulta o selecciona la opciÃ³n que necesitas."

  utter_login_steps:
    - text: |
        Para iniciar sesiÃ³n:
        1) Abre https://zajuna.edu/login
        2) Ingresa tus credenciales
        3) Vuelve y presiona Â«âœ… Ya iniciÃ© sesiÃ³nÂ»
      buttons:
        - title: "ğŸ” Abrir login"
          type: web_url
          url: "https://zajuna.edu/login"
        - title: "âœ… Ya iniciÃ© sesiÃ³n"
          payload: /abrir_chat_autenticado

  # Saludo + MenÃºs
  utter_saludo:
    - text: "Â¡Hola! Soy tu Tutor Virtual. Â¿QuÃ© te gustarÃ­a hacer?"

  utter_saludo_menu:
    - text: |
        Â¡Hola! Soy tu Tutor Virtual. Â¿QuÃ© te gustarÃ­a hacer?
      buttons:
        - title: "ğŸ“š FAQs acadÃ©micas/administrativas"
          payload: /proceso_academico
        - title: "ğŸ› ï¸ Soporte tÃ©cnico bÃ¡sico"
          payload: /soporte_tecnico
        - title: "ğŸ” Ingresar a Zajuna"
          payload: /ingreso_zajuna

  utter_menu_proceso_academico:
    - text: "MenÃº acadÃ©mico: Tutor asignado â€¢ Certificados â€¢ Horarios/Calendario."

  utter_menu_academico:
    - text: |
        MenÃº acadÃ©mico/administrativo:
        â€¢ Estado de estudiante
        â€¢ Certificados
        â€¢ Tutor asignado
      buttons:
        - title: "ğŸ“š SubmenÃº acadÃ©mico"
          payload: /proceso_academico_secundario
        - title: "ğŸ§¾ Estado estudiante"
          payload: /ver_estado_estudiante_info
        - title: "ğŸ“œ Ver certificados"
          payload: /ver_certificados_info
        - title: "ğŸ‘¨â€ğŸ« Tutor asignado"
          payload: /ver_tutor_asignado_info
        - title: "â¬…ï¸ MenÃº principal"
          payload: /saludo


  utter_menu_soporte:
    - text: |
        Soporte tÃ©cnico bÃ¡sico:
        â€¢ Problemas de acceso
        â€¢ Pantalla en blanco
        â€¢ Error en actividad
      buttons:
        - title: "ğŸ™‹ Pedir ayuda humana"
          payload: /escalar_humano
        - title: "â¬…ï¸ MenÃº principal"
          payload: /saludo

  # Informativas / con placeholders autenticados
  utter_estado_estudiante:
    - text: "Tu estado acadÃ©mico es: {estado}."

  utter_ver_certificados:
    - text: "Estos son tus certificados: {lista_certificados}"

  # CatÃ¡logo / tarjetas demo
  utter_catalogo_cursos:
    - text: "AquÃ­ tienes el catÃ¡logo y guÃ­as:"
      buttons:
        - title: "ğŸ“š Oferta acadÃ©mica"
          payload: "https://zajuna.example/cursos"
        - title: "ğŸ“ CÃ³mo inscribirse"
          payload: "https://zajuna.example/guias/inscripcion"
        - title: "ğŸ’¬ Soporte"
          payload: "https://zajuna.example/soporte"

  utter_cursos_recomendados:
    - text: "Cursos recomendados para ti: ProgramaciÃ³n BÃ¡sica, Excel Intermedio, Emprendimiento."

  utter_cursos_carousel:
    - text: "Mostrando carrusel de cursos destacados."

  utter_card_ejemplo:
    - custom:
        cards:
          - title: "Diplomados 2025"
            description: "Todo sobre diplomados del semestre"
            url: "https://zajuna.example/diplomados"
            image: "https://cdn.example/img/diplomados.jpg"

  # Soporte / formulario
  utter_soporte_tecnico:
    - text: "Describe el problema tÃ©cnico y abrimos un ticket."

  utter_preguntar_problema_acceso:
    - text: "Â¿QuÃ© problema de acceso tienes? (pantalla en blanco, clave olvidada, error de plataforma, etc.)"

  utter_soporte_confirm:
    - text: "Â¿Confirmas que enviemos el ticket con la informaciÃ³n capturada?"

  utter_soporte_creado:
    - text: "ğŸ« Ticket creado correctamente."

  utter_soporte_error:
    - text: "âš ï¸ No pudimos crear el ticket en este momento. Intenta mÃ¡s tarde."

  utter_soporte_ava:
    - text: "Soporte AVA: cuÃ©ntame el problema con el aula virtual."

  # Slots del form
  utter_ask_nombre:
    - text: "Â¿CuÃ¡l es tu nombre completo?"

  utter_ask_email:
    - text: "Â¿CuÃ¡l es tu correo electrÃ³nico?"

  utter_ask_mensaje:
    - text: "CuÃ©ntame brevemente el problema (mÃ­nimo 8 caracteres)."

  # Escalado a humano / cierre
  utter_escalar_humano:
    - text: "Â¿Deseas que te conecte con un agente humano?"

  utter_confirmar_escalado:
    - text: "Â¿Deseas que te contacte un asesor humano?"
      buttons:
        - title: "SÃ­, por favor"
          payload: /confirmacion_escalar_humano
        - title: "No, gracias"
          payload: /negar_escalar

  utter_derivado_humano:
    - text: "Listo, te derivÃ© con un asesor humano. Te escribirÃ¡n en breve."

  utter_gracias_continuar:
    - text: "Â¡Listo! Continuemos por aquÃ­."

  # RecuperaciÃ³n
  utter_confirmar_recuperacion:
    - text: "Te enviarÃ© un enlace de recuperaciÃ³n al correo indicado."

  # Problemas tÃ©cnicos comunes
  utter_error_actividad:
    - text: "Parece que tienes un error con tu actividad. Â¿PodrÃ­as especificar cuÃ¡l?"

  utter_pantalla_blanca:
    - text: "Prueba limpiar cachÃ©/recargar. Si sigue en blanco, dime navegador y versiÃ³n."

  utter_problema_no_ingreso:
    - text: "Â¿QuÃ© mensaje aparece al intentar ingresar?"

  utter_otro_problema_acceso:
    - text: "CuÃ©ntame el otro problema de acceso, te ayudo a resolverlo."

  utter_otro_problema_tecnico:
    - text: "Describe el problema tÃ©cnico y, si puedes, adjunta captura."

  # EnvÃ­os varios
  utter_enviar_correo:
    - text: "Correo enviado (demo)."

  utter_enviar_telefono:
    - text: "Nuestro telÃ©fono de contacto es 300 000 0000 (demo)."

  utter_enviar_cedula:
    - text: "Tu cÃ©dula estarÃ¡ disponible tras verificar tu identidad (demo)."

  utter_enviar_url:
    - text: "Enlace: https://ejemplo.edu (demo)."

  utter_enviar_numero:
    - text: "RecibÃ­ el nÃºmero. Â¿Deseas que lo guarde para este caso?"

  # Idioma / horarios / inscripciÃ³n
  utter_cambiar_idioma_espanol:
    - text: "Idioma cambiado a EspaÃ±ol."

  utter_cambiar_idioma_ingles:
    - text: "Language switched to English."

  utter_horarios_calendario:
    - text: "AquÃ­ tienes informaciÃ³n general de horarios y calendario."

  utter_inscribirme:
    - text: "Para inscribirte: 1) verifica requisitos, 2) completa el formulario, 3) confirma tu correo."

  # Encuesta + cierre
  utter_encuesta_satisfaccion:
    - text: "Â¿Esta respuesta te resultÃ³ Ãºtil?"
      buttons:
        - title: "ğŸ‘ SÃ­"
          payload: /encuesta_satis_yes
        - title: "ğŸ‘ No"
          payload: /encuesta_satis_no

  utter_gracias_feedback:
    - text: "Â¡Gracias por tu feedback! Me ayuda a mejorar."

  utter_cierre:
    - text: "Gracias por usar el Tutor Virtual. Â¡Estoy aquÃ­ cuando me necesites! ğŸ™Œ"

  # Instrucciones pedagÃ³gicas (FAQs con pasos)
  utter_instrucciones_estado:
    - text: |
        ğŸ” **CÃ³mo ver tu estado de estudiante en Zajuna**
        1) Ingresa a tu cuenta.
        2) Ve a **Mi perfil** â†’ **Estado acadÃ©mico**.
        3) Si tienes dudas, vuelve aquÃ­ y te guÃ­o.

  utter_instrucciones_certificados:
    - text: |
        ğŸ§¾ **CÃ³mo descargar tus certificados**
        1) Inicia sesiÃ³n en Zajuna.
        2) Abre **Certificados** en tu panel.
        3) Selecciona el curso y pulsa **Descargar**.

  utter_instrucciones_tutor:
    - text: |
        ğŸ‘¨â€ğŸ« **CÃ³mo ver tu tutor asignado**
        1) Inicia sesiÃ³n.
        2) Ve a **Mis cursos** â†’ **Detalle del curso**.
        3) Busca la tarjeta **Tutor asignado** (nombre y contacto).

  utter_link_soporte:
     - text: "Soporte Zajuna: https://zajuna.edu/soporte"
       buttons:
          - title: "ğŸ†˜ Abrir Soporte"
            type: web_url
            url: "https://zajuna.edu/soporte"

forms:
  soporte_form:
    required_slots:
      - nombre
      - email
      - mensaje

  recovery_form:
    required_slots:
      - email

actions:
  - action_check_auth
  - action_check_auth_estado
  - action_sync_auth_from_metadata
  - action_estado_estudiante
  - action_ver_certificados
  - action_listar_certificados
  - action_tutor_asignado
  - action_enviar_soporte
  - action_soporte_submit
  - action_submit_soporte
  - action_enviar_correo
  - action_conectar_humano
  - action_health_check
  - action_submit_recovery
  - action_mark_authenticated         
  - action_start_flow
  - action_preguntar_resolucion
  - action_registrar_encuesta
  - action_derivar_y_registrar_humano

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
