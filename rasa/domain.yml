version: "3.1"

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true

intents:
  - saludo
  - explorar_temas            # ğŸ‘ˆ usado en stories
  - ingreso_zajuna
  - otro_problema_acceso
  - proceso_academico
  - tutor_asignado
  - horarios_calendario       # ğŸ‘ˆ usado en stories
  - estado_estudiante
  - estado_estudiante_info
  - ver_certificados
  - ver_certificados_info
  - necesita_auth
  - soporte_tecnico
  - otro_problema_tecnico
  - problema_no_ingreso
  - pantalla_blanca
  - error_actividad
  - deny
  - affirm
  - recuperar_contrasena
  - escalar_humano            # ğŸ‘ˆ usado en stories/rules
  - confirmacion_escalar_humano
  - negar_escalar
  - cambiar_idioma_ingles
  - cambiar_idioma_espanol
  - inscribirme
  - enviar_correo
  - enviar_telefono
  - enviar_cedula
  - enviar_numero
  - enviar_url
  - soporte_confirmar
  - soporte_error
  - auth_login
  - auth_login_cmd
  - enviar_soporte
  - enviar_soporte_directo
  - fallback
  - nlu_fallback
  - pedir_correo
  - pedir_email
  - pedir_nombre
  - pedir_mensaje
  - soporte_ava_directo
  - estado_estudiante
  - ver_certificados
  - tutor_asignado
  - ingreso_zajuna        
  - abrir_chat_autenticado
entities:
  - nombre      
  - email
  - telefono
  - cedula
  - numero
  - url

slots:
  nombre:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
  email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
  mensaje:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
  telefono:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: telefono
      - type: from_text
  has_token:
    type: bool
    influence_conversation: true
    initial_value: false
    mappings:
      - type: custom

forms:
  soporte_form:
    required_slots:
      - nombre
      - email
      - mensaje
      # telÃ©fono es opcional (lo pedimos si quieres en rules/stories)
  recovery_form:
    required_slots:
      - email

responses:

  # ğŸ‘‹ Saludo + menÃº de arranque controlado por Rasa
  utter_saludo:
    - text: "Â¡Hola! Soy tu asistente Zajuna ğŸ¤–. Â¿En quÃ© puedo ayudarte?"
      buttons:
        - title: "Explorar temas"
          payload: "/explorar_temas"
        - title: "Ingreso a Zajuna"
          payload: "/ingreso_zajuna"
        - title: "Soporte tÃ©cnico"
          payload: "/soporte_tecnico"

  # ğŸ” Ingreso a Zajuna
  utter_preguntar_problema_acceso:
    - text: "Â¿Con quÃ© necesitas ayuda para ingresar?"
      buttons:
        - title: "Recuperar contraseÃ±a"
          payload: "/recuperar_contrasena"
        - title: "No puedo ingresar"
          payload: "/problema_no_ingreso"
        - title: "Otro problema de acceso"
          payload: "/otro_problema_acceso"

  # ğŸ“š Proceso acadÃ©mico (menÃº)
  utter_menu_proceso_academico:
    - text: "Puedo ayudarte con diferentes partes del proceso acadÃ©mico:"
      buttons:
        - title: "MatrÃ­cula"
          payload: "/proceso_academico"
        - title: "Pagos y becas"
          payload: "/proceso_academico"
        - title: "Certificados"
          payload: "/ver_certificados_info"

  # ğŸ‘©â€ğŸ« Tutor asignado (informativo)
  utter_tutor_asignado:
    - text: "Tu tutor asignado serÃ¡ visible en tu panel acadÃ©mico. Si necesitas mÃ¡s informaciÃ³n, puedo guiarte."

  # âœ… Certificados (informaciÃ³n sin auth)
  utter_certificados_info:
    - text: "Para descargar certificados visita el mÃ³dulo de certificados en Zajuna. Si necesitas asistencia, te puedo guiar paso a paso."

  # ğŸ§‘â€ğŸ’» Soporte (arranque de form por reglas)
  utter_soporte_tecnico:
    - text: "Te ayudarÃ© creando un ticket de soporte. Te harÃ© algunas preguntas."

  # ğŸ“ Preguntas del soporte_form
  utter_ask_nombre:
    - text: "Â¿CuÃ¡l es tu nombre?"
  utter_ask_email:
    - text: "Â¿CuÃ¡l es tu correo electrÃ³nico?"
  utter_ask_mensaje:
    - text: "CuÃ©ntame brevemente el problema."
  utter_ask_telefono:
    - text: "Si deseas, indÃ­came un nÃºmero de contacto (opcional)."

  # âœ… Resumen de soporte y confirmaciones
  utter_soporte_resumen:
    - text: "Resumen del caso:\nâ€¢ Nombre: {nombre}\nâ€¢ Email: {email}\nâ€¢ TelÃ©fono: {telefono}\nâ€¢ Mensaje: {mensaje}"
  utter_soporte_creado:
    - text: "Â¡Listo! He enviado tu solicitud de soporte."
  utter_soporte_form_ok:
    - text: "Nuestro equipo te contactarÃ¡ pronto. Â¿Deseas algo mÃ¡s?"
  utter_soporte_confirm:
    - text: "Perfecto, confirmo tu solicitud de soporte."
  utter_soporte_error:
    - text: "Hubo un problema al crear el ticket. IntÃ©ntalo de nuevo o prueba mÃ¡s tarde."

  # ğŸ”‘ Estado/Certificados protegidos â†’ pedir auth
  utter_need_auth:
    - text: "Para continuar con esa acciÃ³n necesitas iniciar sesiÃ³n."
      buttons:
        - title: "ğŸ” Iniciar sesiÃ³n"
          payload: "/ingreso_zajuna"
        - title: "Abrir chat autenticado"
          payload: "/abrir_chat_autenticado"

  # ğŸ” RecuperaciÃ³n de contraseÃ±a
  utter_confirmar_recuperacion:
    - text: "Si el correo es vÃ¡lido, recibirÃ¡s un enlace para restablecer la contraseÃ±a."

  # ğŸ‘/ğŸ‘ y continuar
  utter_gracias_continuar:
    - text: "Gracias. Â¿Deseas continuar con otra consulta?"

  # ğŸŒ Cambio de idioma
  utter_cambio_idioma_ingles:
    - text: "Language switched to English."
  utter_cambio_idioma_espanol:
    - text: "Ahora hablamos en espaÃ±ol ğŸ‡ªğŸ‡¸."

  # ğŸ“§ Confirmaciones genÃ©ricas
  utter_enviar_correo:
    - text: "He enviado el correo. Revisa tu bandeja de entrada por favor."
  utter_enviar_telefono:
    - text: "Gracias por compartir tu telÃ©fono."
  utter_enviar_cedula:
    - text: "Gracias por compartir tu cÃ©dula."
  utter_enviar_numero:
    - text: "Gracias por compartir el nÃºmero."
  utter_enviar_url:
    - text: "Gracias por compartir el enlace."

  # ğŸš¨ Fallbacks
  utter_default:
    - text: "No estoy seguro de haber entendido. Â¿Puedes reformular tu consulta?"
  utter_fallback:
    - text: "TambiÃ©n puedo ayudarte con: ingreso a Zajuna, soporte tÃ©cnico y proceso acadÃ©mico."
      buttons:
        - title: "Ingreso a Zajuna"
          payload: "/ingreso_zajuna"
        - title: "Soporte tÃ©cnico"
          payload: "/soporte_tecnico"
        - title: "Proceso acadÃ©mico"
          payload: "/proceso_academico"

  # ğŸ§­ Explorar (para stories)
  utter_cursos_recomendados:
    - text: "Te recomiendo estos temas para comenzar:"
      buttons:
        - title: "Python BÃ¡sico"
          payload: "/inscribirme"
        - title: "IA Educativa"
          payload: "/inscribirme"
        - title: "Excel BÃ¡sico"
          payload: "/inscribirme"

  # Carrusel (si tu canal lo soporta; si no, queda como lista textual)
  utter_cursos_carousel:
    - text: "Explora nuestro carrusel de cursos destacados (usa las flechas para navegar)."

  # ğŸ™‹ Escalado humano
  utter_escalar_humano:
    - text: "Â¿Deseas que te conecte con un asesor humano?"
      buttons:
        - title: "SÃ­, por favor"
          payload: "/confirmacion_escalar_humano"
        - title: "No, sigamos aquÃ­"
          payload: "/negar_escalar"

  utter_confirmar_escalado:
    - text: "Perfecto, te estoy conectando con un asesor humano. ğŸ™‹"
  # ğŸ“ InscripciÃ³n (placeholder usado por la regla "Inscribirme")
  utter_confirmacion_inscripcion:
    - text: "Â¡Genial! Para inscribirte, ingresa a tu cuenta y selecciona el curso deseado. Si quieres, puedo guiarte."

  # ğŸ“§ Pedir correo (placeholder usado por la regla 'Pedir correo')
  utter_pedir_correo:
    - text: "Â¿CuÃ¡l es tu correo electrÃ³nico?"
  utter_soporte_pqrs:
    - text: "Para radicar o consultar una PQRS usa el sistema oficial del SENA:"
      buttons:
        - title: "ğŸ“¨ Radicar / Consultar PQRS"
          payload: "https://sciudadanos.sena.edu.co/SolicitudIndex.aspx"

  utter_soporte_ava:
    - text: "Soporte del Ambiente Virtual de Aprendizaje (SAVA):"
      buttons:
        - title: "ğŸ› ï¸ Soporte AVA (SAVA)"
          payload: "https://sava.sena.edu.co/gfvd/"

  utter_ingreso_zajuna_instrucciones:
    - text: |
        Portal principal de Zajuna:
        â€¢ Acceso: https://zajuna.sena.edu.co/

        Â¿No puedes ingresar?
        1) Si OLVIDASTE la contraseÃ±a â†’ usa â€œÂ¿OlvidÃ© mi contraseÃ±a?â€ en el portal.
        2) Si NO TIENES cuenta â†’ usa â€œRegistrarseâ€ y completa tus datos.
        3) Si el problema persiste â†’ abre un ticket en SAVA o radica una PQRS.

      buttons:
        - title: "ğŸ” Ir a Zajuna"
          payload: "https://zajuna.sena.edu.co/"
        - title: "ğŸ› ï¸ Soporte AVA (SAVA)"
          payload: "https://sava.sena.edu.co/gfvd/"
        - title: "ğŸ“¨ PQRS SENA"
          payload: "https://sciudadanos.sena.edu.co/SolicitudIndex.aspx"
  # (Opcional) mensaje cuando el usuario cliquea "ingreso_zajuna"
  utter_login_hint:
    - text: "Abre el login de Zajuna e inicia sesiÃ³n. Si estÃ¡s en el portal, regresaremos el token automÃ¡ticamente al chat."

actions:
  - action_check_auth
  - action_soporte_submit
  - action_enviar_correo
  - action_conectar_humano
  - action_enviar_soporte
  - action_deactivate_loop  
  - action_sync_auth_from_metadata
  - action_estado_estudiante
  - action_ver_certificados
  - action_tutor_asignado
  