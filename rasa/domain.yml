version: "3.1"

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true

intents:
  - saludo
  - explorar_temas            # 👈 usado en stories
  - ingreso_zajuna
  - otro_problema_acceso
  - proceso_academico
  - tutor_asignado
  - horarios_calendario       # 👈 usado en stories
  - estado_estudiante
  - estado_estudiante_info
  - ver_certificados
  - ver_certificados_info
  - necesita_auth
  - soporte_tecnico
  - otro_problema_tecnico
  - problema_no_ingreso
  - pantalla_blanca
  - error_actividad
  - deny
  - affirm
  - recuperar_contrasena
  - escalar_humano            # 👈 usado en stories/rules
  - confirmacion_escalar_humano
  - negar_escalar
  - cambiar_idioma_ingles
  - cambiar_idioma_espanol
  - inscribirme
  - enviar_correo
  - enviar_telefono
  - enviar_cedula
  - enviar_numero
  - enviar_url
  - soporte_confirmar
  - soporte_error
  - auth_login
  - auth_login_cmd
  - enviar_soporte
  - enviar_soporte_directo
  - fallback
  - nlu_fallback
  - pedir_correo
  - pedir_email
  - pedir_nombre
  - pedir_mensaje
  - soporte_ava_directo
entities:
  - nombre        # 👈 anotaste nombres en NLU
  - email
  - telefono
  - cedula
  - numero
  - url

slots:
  nombre:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
  email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
  mensaje:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
  telefono:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: telefono
      - type: from_text

# ❗️En versiones 3.x los mapeos de slots van en `slots: ... mappings:`.
# Si tenías un bloque `slot_mappings:` a nivel raíz, Rasa no lo usa.
# Ya incorporé esos mismos mapeos arriba, slot por slot.

forms:
  soporte_form:
    required_slots:
      - nombre
      - email
      - mensaje
      # teléfono es opcional (lo pedimos si quieres en rules/stories)
  recovery_form:
    required_slots:
      - email

responses:

  # 👋 Saludo + menú de arranque controlado por Rasa
  utter_saludo:
    - text: "¡Hola! Soy tu asistente Zajuna 🤖. ¿En qué puedo ayudarte?"
      buttons:
        - title: "Explorar temas"
          payload: "/explorar_temas"
        - title: "Ingreso a Zajuna"
          payload: "/ingreso_zajuna"
        - title: "Soporte técnico"
          payload: "/soporte_tecnico"

  # 🔐 Ingreso a Zajuna
  utter_preguntar_problema_acceso:
    - text: "¿Con qué necesitas ayuda para ingresar?"
      buttons:
        - title: "Recuperar contraseña"
          payload: "/recuperar_contrasena"
        - title: "No puedo ingresar"
          payload: "/problema_no_ingreso"
        - title: "Otro problema de acceso"
          payload: "/otro_problema_acceso"

  # 📚 Proceso académico (menú)
  utter_menu_proceso_academico:
    - text: "Puedo ayudarte con diferentes partes del proceso académico:"
      buttons:
        - title: "Matrícula"
          payload: "/proceso_academico"
        - title: "Pagos y becas"
          payload: "/proceso_academico"
        - title: "Certificados"
          payload: "/ver_certificados_info"

  # 👩‍🏫 Tutor asignado (informativo)
  utter_tutor_asignado:
    - text: "Tu tutor asignado será visible en tu panel académico. Si necesitas más información, puedo guiarte."

  # ✅ Certificados (información sin auth)
  utter_certificados_info:
    - text: "Para descargar certificados visita el módulo de certificados en Zajuna. Si necesitas asistencia, te puedo guiar paso a paso."

  # 🧑‍💻 Soporte (arranque de form por reglas)
  utter_soporte_tecnico:
    - text: "Te ayudaré creando un ticket de soporte. Te haré algunas preguntas."

  # 📝 Preguntas del soporte_form
  utter_ask_nombre:
    - text: "¿Cuál es tu nombre?"
  utter_ask_email:
    - text: "¿Cuál es tu correo electrónico?"
  utter_ask_mensaje:
    - text: "Cuéntame brevemente el problema."
  utter_ask_telefono:
    - text: "Si deseas, indícame un número de contacto (opcional)."

  # ✅ Resumen de soporte y confirmaciones
  utter_soporte_resumen:
    - text: "Resumen del caso:\n• Nombre: {nombre}\n• Email: {email}\n• Teléfono: {telefono}\n• Mensaje: {mensaje}"
  utter_soporte_creado:
    - text: "¡Listo! He enviado tu solicitud de soporte."
  utter_soporte_form_ok:
    - text: "Nuestro equipo te contactará pronto. ¿Deseas algo más?"
  utter_soporte_confirm:
    - text: "Perfecto, confirmo tu solicitud de soporte."
  utter_soporte_error:
    - text: "Hubo un problema al crear el ticket. Inténtalo de nuevo o prueba más tarde."

  # 🔑 Estado/Certificados protegidos → pedir auth
  utter_need_auth:
    - text: "Necesitas iniciar sesión para continuar con esta acción."
  utter_estado_estudiante:
    - text: "Puedo consultar tu estado académico cuando inicies sesión."

  # 🔁 Recuperación de contraseña
  utter_confirmar_recuperacion:
    - text: "Si el correo es válido, recibirás un enlace para restablecer la contraseña."

  # 👍/👎 y continuar
  utter_gracias_continuar:
    - text: "Gracias. ¿Deseas continuar con otra consulta?"

  # 🌐 Cambio de idioma
  utter_cambio_idioma_ingles:
    - text: "Language switched to English."
  utter_cambio_idioma_espanol:
    - text: "Ahora hablamos en español 🇪🇸."

  # 📧 Confirmaciones genéricas
  utter_enviar_correo:
    - text: "He enviado el correo. Revisa tu bandeja de entrada por favor."
  utter_enviar_telefono:
    - text: "Gracias por compartir tu teléfono."
  utter_enviar_cedula:
    - text: "Gracias por compartir tu cédula."
  utter_enviar_numero:
    - text: "Gracias por compartir el número."
  utter_enviar_url:
    - text: "Gracias por compartir el enlace."

  # 🚨 Fallbacks
  utter_default:
    - text: "No estoy seguro de haber entendido. ¿Puedes reformular tu consulta?"
  utter_fallback:
    - text: "También puedo ayudarte con: ingreso a Zajuna, soporte técnico y proceso académico."
      buttons:
        - title: "Ingreso a Zajuna"
          payload: "/ingreso_zajuna"
        - title: "Soporte técnico"
          payload: "/soporte_tecnico"
        - title: "Proceso académico"
          payload: "/proceso_academico"

  # 🧭 Explorar (para stories)
  utter_cursos_recomendados:
    - text: "Te recomiendo estos temas para comenzar:"
      buttons:
        - title: "Python Básico"
          payload: "/inscribirme"
        - title: "IA Educativa"
          payload: "/inscribirme"
        - title: "Excel Básico"
          payload: "/inscribirme"

  # Carrusel (si tu canal lo soporta; si no, queda como lista textual)
  utter_cursos_carousel:
    - text: "Explora nuestro carrusel de cursos destacados (usa las flechas para navegar)."

  # 🙋 Escalado humano
  utter_escalar_humano:
    - text: "¿Deseas que te conecte con un asesor humano?"
      buttons:
        - title: "Sí, por favor"
          payload: "/confirmacion_escalar_humano"
        - title: "No, sigamos aquí"
          payload: "/negar_escalar"

  utter_confirmar_escalado:
    - text: "Perfecto, te estoy conectando con un asesor humano. 🙋"
  # 📝 Inscripción (placeholder usado por la regla "Inscribirme")
  utter_confirmacion_inscripcion:
    - text: "¡Genial! Para inscribirte, ingresa a tu cuenta y selecciona el curso deseado. Si quieres, puedo guiarte."

  # 📧 Pedir correo (placeholder usado por la regla 'Pedir correo')
  utter_pedir_correo:
    - text: "¿Cuál es tu correo electrónico?"
  utter_soporte_pqrs:
    - text: "Para radicar o consultar una PQRS usa el sistema oficial del SENA:"
      buttons:
        - title: "📨 Radicar / Consultar PQRS"
          payload: "https://sciudadanos.sena.edu.co/SolicitudIndex.aspx"

  utter_soporte_ava:
    - text: "Soporte del Ambiente Virtual de Aprendizaje (SAVA):"
      buttons:
        - title: "🛠️ Soporte AVA (SAVA)"
          payload: "https://sava.sena.edu.co/gfvd/"

  utter_ingreso_zajuna_instrucciones:
    - text: |
        Portal principal de Zajuna:
        • Acceso: https://zajuna.sena.edu.co/

        ¿No puedes ingresar?
        1) Si OLVIDASTE la contraseña → usa “¿Olvidé mi contraseña?” en el portal.
        2) Si NO TIENES cuenta → usa “Registrarse” y completa tus datos.
        3) Si el problema persiste → abre un ticket en SAVA o radica una PQRS.

      buttons:
        - title: "🔐 Ir a Zajuna"
          payload: "https://zajuna.sena.edu.co/"
        - title: "🛠️ Soporte AVA (SAVA)"
          payload: "https://sava.sena.edu.co/gfvd/"
        - title: "📨 PQRS SENA"
          payload: "https://sciudadanos.sena.edu.co/SolicitudIndex.aspx"
actions:
  - action_check_auth
  - action_soporte_submit
  - action_enviar_correo
  - action_conectar_humano
  - action_enviar_soporte
  - action_deactivate_loop  
  