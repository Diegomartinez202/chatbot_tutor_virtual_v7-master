#\rasa\data\rules\rules_soporte.yml
version: "3.1"

# =========================================================
# üß© REGLAS DEL DOMINIO DE SOPORTE Y SATISFACCI√ìN - ZAJUNA BOT
# =========================================================
# Controla el flujo de contacto humano, encuesta de satisfacci√≥n,
# retorno al men√∫ o cierre de conversaci√≥n.
# =========================================================

rules:

  - rule: Iniciar formulario de soporte
    steps:
      - intent: solicitar_soporte
      - action: utter_formulario_soporte_intro
      - action: utter_formulario_soporte_campos
      - action: zajuna_guardar_ticket_soporte
      - action: utter_soporte_registrado
      - action: utter_preguntar_satisfaccion

  # --- Flujo de satisfacci√≥n positiva ---
  - rule: Usuario satisfecho
    steps:
      - intent: respuesta_satisfecho
      - action: utter_encuesta_positiva
      - action: utter_preguntar_continuar_menu

  # --- Flujo de satisfacci√≥n negativa ---
  - rule: Usuario insatisfecho ‚Üí ofrecer contacto con tutor
    steps:
      - intent: respuesta_insatisfecho
      - action: utter_encuesta_negativa
      - action: utter_ofrecer_contacto_tutor

  - rule: Enviar correo a tutor
    steps:
      - intent: enviar_correo_tutor
      - action: zajuna_enviar_correo_tutor
      - action: utter_correo_enviado
      - action: utter_preguntar_continuar_menu


  - rule: Continuar desde encuesta ‚Üí men√∫ o cierre
    steps:
      - intent: continuar_consulta
      - action: utter_menu_general

  - rule: Terminar conversaci√≥n desde encuesta
    steps:
      - intent: terminar_conversacion
      - action: utter_despedida_profesional
  
  - rule: Abrir flujo de soporte
    steps:
    - intent: solicitar_soporte
    - action: utter_solicitar_soporte_intro
    - action: soporte_form
    - active_loop: soporte_form

  # --- Submit soporte_form ---
  - rule: Submit soporte_form
    condition:
    - active_loop: soporte_form
    steps:
    - action: soporte_form
    - active_loop: null
    - action: action_enviar_soporte
    - action: utter_soporte_registrado

  # --- Ofrecer humano (gen√©rico) ---
  - rule: Ofrecer agente humano expl√≠cito
    steps:
    - intent: necesita_humano
    - action: utter_ofrecer_humano

  # --- Confirmar derivaci√≥n a humano ---
  - rule: Derivar a humano (affirm)
    steps:
    - intent: affirm
    - action: action_derivar_y_registrar_humano
    - action: utter_derivando_humano

  # --- Cancelar derivaci√≥n ---
  - rule: Cancelar derivaci√≥n (deny)
    steps:
    - intent: deny
    - action: utter_derivacion_cancelada