#\rasa\data\rules\rules_academico.yml
version: "3.1"
rules:

  - rule: Solicitud de autenticación si no está autenticado
    condition:
      - slot_was_set:
          - is_authenticated: false
    steps:
      - intent: consultar_certificados
      - action: utter_pedir_autenticacion
      - action: utter_mostrar_pasos_autenticacion
      - action: utter_boton_autenticacion

  - rule: Consultar certificados (autenticado)
    condition:
      - slot_was_set:
          - is_authenticated: true
    steps:
      - intent: consultar_certificados
      - action: zajuna_get_certificados
      - action: utter_certificados_encontrados
      - action: utter_preguntar_continuar_menu

  - rule: Consultar estado académico (autenticado)
    condition:
      - slot_was_set:
          - is_authenticated: true
    steps:
      - intent: ver_estado_estudiante
      - action: zajuna_get_estado_estudiante
      - action: utter_estado_encontrado
      - action: utter_preguntar_continuar_menu

  - rule: Ver estado estudiante (no autenticado)
    condition:
      - slot_was_set:
          - is_authenticated: false
    steps:
      - intent: ver_estado_estudiante
      - action: utter_pedir_autenticacion
      - active_loop: login_form

  - rule: Volver al menú general
    steps:
      - intent: ir_menu_principal
      - action: utter_menu_general

  - rule: Cierre profesional desde dominio académico
    steps:
      - intent: terminar_conversacion
      - action: utter_despedida_profesional

  # Fallback (NLU)
  - rule: Fallback general
    steps:
      - intent: nlu_fallback
      - action: utter_fallback
