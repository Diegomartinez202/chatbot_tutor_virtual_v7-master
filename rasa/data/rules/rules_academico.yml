version: "3.1"

# =========================================================
# üß† REGLAS DEL DOMINIO ACAD√âMICO - ZAJUNA BOT
# =========================================================
# Controla el flujo de autenticaci√≥n, consulta de certificados,
# estado del estudiante y retorno al men√∫ principal.
# =========================================================

rules:

  - rule: Solicitud de autenticaci√≥n si no est√° autenticado
    condition:
      - slot_was_set:
          - is_authenticated: false
    steps:
      - intent: consultar_certificados
      - action: utter_pedir_autenticacion
      - action: utter_mostrar_pasos_autenticacion
      - action: utter_boton_autenticacion

  - rule: Consultar certificados (autenticado)
    condition:
      - slot_was_set:
          - is_authenticated: true
    steps:
      - intent: consultar_certificados
      - action: zajuna_get_certificados
      - action: utter_certificados_encontrados
      - action: utter_preguntar_continuar_menu

  - rule: Consultar estado acad√©mico (autenticado)
    condition:
      - slot_was_set:
          - is_authenticated: true
    steps:
      - intent: ver_estado_estudiante
      - action: zajuna_get_estado_estudiante
      - action: utter_estado_encontrado
      - action: utter_preguntar_continuar_menu

  - rule: Volver al men√∫ general
    steps:
      - intent: ir_menu_principal
      - action: utter_menu_general

  - rule: Cierre profesional desde dominio acad√©mico
    steps:
      - intent: terminar_conversacion
      - action: utter_despedida_profesional
  
  - rule: Consultar certificados autenticado
    condition:
      - slot_was_set:
          - is_authenticated: true
    steps:
      - intent: consultar_certificados
      - action: action_ver_certificados
      - action: utter_confirmacion_consulta

  - rule: Consultar certificados no autenticado
    condition:
      - slot_was_set:
          - is_authenticated: false
    steps:
      - intent: consultar_certificados
      - action: utter_pedir_autenticacion
      - active_loop: login_form

  - rule: Fallback general
    steps:
      - intent: fallback
      - action: utter_fallback
  
  - rule: Ver estado estudiante autenticado
    condition:
      - slot_was_set:
          - is_authenticated: true
    steps:
      - intent: ver_estado_estudiante
      - action: action_ver_estado_estudiante
      - action: utter_estado_estudiante

  - rule: Ver estado estudiante no autenticado
    condition:
      - slot_was_set:
          - is_authenticated: false
    steps:
      - intent: ver_estado_estudiante
      - action: utter_pedir_autenticacion
      - active_loop: login_form



