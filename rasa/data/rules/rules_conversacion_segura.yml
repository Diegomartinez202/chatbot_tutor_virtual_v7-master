version: "3.1"

rules:

- rule: Cierre seguro detectado
  steps:
    - intent: terminar_conversacion_segura
    - action: action_confirmar_cierre_seguro

- rule: Confirmar cierre con autosave
  condition:
    - slot_was_set:
        - encuesta_activa: true
  steps:
    - intent: confirmar_cierre
    - action: action_autosave_encuesta
    - action: action_guardar_autosave_mongo
    - action: utter_cierre_confirmado
    - action: action_reset_conversacion_segura

- rule: Cancelar cierre seguro
  steps:
    - intent: cancelar_cierre
    - action: utter_cierre_cancelado

- rule: Reanudar conversación automática
  steps:
    - intent: reanudar_conversacion
    - action: action_cargar_autosave_mongo
    - action: action_autoresume_conversacion
