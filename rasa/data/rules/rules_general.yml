version: "3.1"

rules:

  # =====================================
  #         üîπ REGLAS GENERALES
  # =====================================

  # --- Fallback NLU ---
  - rule: Manejar fallback (no entendido)
    steps:
      - intent: nlu_fallback
      - action: utter_fallback

  # --- Sincronizaci√≥n de autenticaci√≥n desde metadatos ---
  - rule: Sincronizar auth desde metadata
    steps:
      - action: action_sync_auth_from_metadata

  # --- Inicio de sesi√≥n (ayuda) ---
  - rule: Login por comando
    steps:
      - intent: auth_login_cmd
      - action: utter_login_steps

  # --- Marcar autenticado tras login exitoso ---
  - rule: Marcar autenticado
    steps:
      - intent: abrir_chat_autenticado
      - action: action_mark_authenticated
      - action: utter_login_hint

  # --- Saludo inicial y men√∫ principal ---
  - rule: Saludo inicial ‚Üí mostrar men√∫
    steps:
      - intent: saludo
      - action: utter_saludo
      - action: utter_saludo_menu

  # --- Cambiar idioma a espa√±ol ---
  - rule: Cambiar idioma a espa√±ol
    steps:
      - intent: cambiar_idioma_espanol
      - action: utter_cambiar_idioma_espanol

  # --- Cambiar idioma a ingl√©s ---
  - rule: Cambiar idioma a ingl√©s
    steps:
      - intent: cambiar_idioma_ingles
      - action: utter_cambiar_idioma_ingles

  # --- Intents de afirmaci√≥n ---
  - rule: Afirmaci√≥n gen√©rica
    steps:
      - intent: affirm
      - action: utter_affirm

  # --- Intents de negaci√≥n ---
  - rule: Negaci√≥n gen√©rica
    steps:
      - intent: deny
      - action: utter_deny

  # --- Intents de n√∫meros o contacto ---
  - rule: Enviar n√∫mero de contacto
    steps:
      - intent: enviar_numero
      - action: utter_enviar_numero

  # --- Ingreso a plataforma (ej. Zajuna) ---
  - rule: Instrucciones de ingreso
    steps:
      - intent: ingreso_zajuna
      - action: utter_ingreso_zajuna_instrucciones
      - action: action_preguntar_resolucion

  # --- Ver cat√°logo general de cursos ---
  - rule: Mostrar cat√°logo
    steps:
      - intent: ver_catalogo
      - action: utter_catalogo_cursos
      - action: action_preguntar_resolucion

  # --- Mostrar tarjeta demo (card ejemplo) ---
  - rule: Mostrar tarjeta demo
    steps:
      - intent: ver_card_demo
      - action: utter_card_ejemplo
      - action: action_preguntar_resolucion

  # --- Ver ayuda o hint de login ---
  - rule: Ver login hint
    steps:
      - intent: ver_login_hint
      - action: utter_login_hint

  # --- Ver confirmaci√≥n de recuperaci√≥n ---
  - rule: Ver confirmaci√≥n de recuperaci√≥n
    steps:
      - intent: ver_confirmar_recuperacion_info
      - action: utter_confirmar_recuperacion

  # --- Ver enlace de soporte ---
  - rule: Ver enlace de soporte
    steps:
      - intent: ver_link_soporte
      - action: utter_link_soporte

  # --- Ver confirmaci√≥n de ticket ---
  - rule: Ver ticket de soporte creado
    steps:
      - intent: ver_soporte_creado_info
      - action: utter_soporte_creado

  # --- Escalar a humano ---
  - rule: Escalar a humano (pregunta)
    steps:
      - intent: escalar_humano
      - action: utter_escalar_humano

  - rule: Escalar a humano (confirmar)
    steps:
      - intent: confirmacion_escalar_humano
      - action: action_conectar_humano
      - action: utter_confirmar_escalado
      - action: action_preguntar_resolucion

  - rule: Escalar a humano (rechazado)
    steps:
      - intent: negar_escalar
      - action: utter_gracias_continuar

  # --- Flujo de cierre general (sin encuesta) ---
  - rule: Cierre simple
    steps:
      - intent: cerrar_chat
      - action: utter_cierre

  # --- Flujo gen√©rico post-respuesta ---
  - rule: Despu√©s de una acci√≥n ‚Üí preguntar resoluci√≥n
    steps:
      - action: action_preguntar_resolucion
