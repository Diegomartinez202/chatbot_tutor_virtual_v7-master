# ops/nginx/conf.d/prod/prod-https.conf

# ===== RedirecciÃ³n HTTP â†’ HTTPS =====
server {
  listen 80;
  server_name _;
  return 301 https://$host$request_uri;
}

# ===== Upstreams PROD =====
upstream admin_up   { server admin:80   max_fails=3 fail_timeout=5s; }
upstream backend_up { server backend:8000 max_fails=3 fail_timeout=5s; }
upstream rasa_up    { server rasa:5005 max_fails=3 fail_timeout=5s; }

# ===== Servidor HTTPS principal =====
server {
  listen 443 ssl http2;
  server_name _;

  ssl_certificate     /etc/nginx/certs/fullchain.pem;
  ssl_certificate_key /etc/nginx/certs/privkey.pem;
  include /etc/nginx/conf.d/prod/includes/tls_params.conf;

  # ðŸ‘‡ Inyecta todos los locations comunes
  include /etc/nginx/conf.d/common/includes/locations.inc;
}
