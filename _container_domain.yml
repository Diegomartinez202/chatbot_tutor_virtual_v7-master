version: "3.1"

intents:
  # Base / navegaci√≥n
  - saludo
  - nlu_fallback
  - explorar_temas
  - proceso_academico
  - horarios_calendario
  - tutor_asignado
  - estado_estudiante
  - ver_certificados
  - ver_certificados_info
  - ingreso_zajuna
  # Escalado a humano
  - escalar_humano
  - confirmacion_escalar_humano
  - negar_escalar

  # Soporte t√©cnico
  - soporte_tecnico
  - problema_no_ingreso
  - pantalla_blanca
  - error_actividad
  - otro_problema_tecnico
  - otro_problema_acceso

  # Forms y datos
  - enviar_soporte
  - enviar_soporte_directo
  - soporte_confirmar
  - soporte_error
  - soporte_ava_directo
  - pedir_nombre
  - pedir_email
  - pedir_correo
  - pedir_mensaje
  - enviar_correo
  - enviar_telefono
  - enviar_cedula
  - enviar_url
  - enviar_numero

  # Auth / recovery / idioma / inscripciones
  - recuperar_contrasena
  - confirmar_recuperacion
  - abrir_chat_autenticado
  - necesita_auth
  - cambiar_idioma_espanol
  - cambiar_idioma_ingles
  - inscribirme

  # Afirmaciones
  - affirm
  - deny       
  - ver_catalogo   
entities:
  - nombre
  - email
  - mensaje                 
  - ver_link_soporte               
  - ver_card_demo                  
  - ver_login_hint                 
  - ver_pregunta_acceso            
  - ver_soporte_tecnico_info       
  - ver_confirmar_recuperacion_info
  - ver_error_actividad_info       
  - ver_tutor_asignado_info 
  - auth_login_cmd
  - ver_estado_estudiante_info
slots:
  has_token:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
      - type: custom    # lo setea action_sync_auth_from_metadata

  nombre:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: nombre
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: nombre

  email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: email
          - active_loop: recovery_form
            requested_slot: email

  mensaje:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: mensaje
      - type: from_text
        conditions:
          - active_loop: soporte_form
            requested_slot: mensaje

responses:
  # --- Fallback / Login / Auth ---
  utter_fallback:
    - text: "No te entend√≠ bien ü§î. ¬øPuedes reformularlo o elegir una opci√≥n del men√∫?"

  utter_need_auth:
    - text: "Para continuar necesito que inicies sesi√≥n. Pulsa **Iniciar sesi√≥n** y vuelve a intentarlo."

  utter_ingreso_zajuna_instrucciones:
    - text: "Para ingresar a Zajuna: 1) Pulsa **Iniciar sesi√≥n** 2) Autoriza en la ventana 3) Regresa al chat (se sincroniza autom√°ticamente)."

  utter_login_hint:
    - text: "Si ya iniciaste sesi√≥n, escribe de nuevo la consulta o selecciona la opci√≥n que necesitas."

  utter_preguntar_problema_acceso:
    - text: "¬øQu√© problema de acceso tienes? (pantalla en blanco, clave olvidada, error de plataforma, etc.)"

  # --- Informativos / Cat√°logo ---
  utter_estado_estudiante:
    - text: "Tu estado acad√©mico estar√° disponible al iniciar sesi√≥n ‚úÖ."

  utter_certificados_info:
    - text: "Los certificados se descargan desde tu cuenta. Inicia sesi√≥n y te muestro el listado."

  utter_catalogo_cursos:
    - text: "Aqu√≠ tienes el cat√°logo y gu√≠as:"
      buttons:
        - title: "üìö Oferta acad√©mica"
          payload: "https://zajuna.example/cursos"
        - title: "üìù C√≥mo inscribirse"
          payload: "https://zajuna.example/guias/inscripcion"
        - title: "üí¨ Soporte"
          payload: "https://zajuna.example/soporte"

  utter_link_soporte:
    - text: "Si necesitas ayuda, visita https://zajuna.example/soporte"


  utter_card_ejemplo:
    - custom:
        cards:
          - title: "Diplomados 2025"
            description: "Todo sobre diplomados del semestre"
            url: "https://zajuna.example/diplomados"
            image: "https://cdn.example/img/diplomados.jpg"

  utter_cursos_recomendados:
    - text: "Cursos recomendados para ti: Programaci√≥n B√°sica, Excel Intermedio, Emprendimiento."

  utter_cursos_carousel:
    - text: "Mostrando carrusel de cursos destacados."

  # --- Men√∫s y flujo acad√©mico ---
  utter_saludo:
    - text: "¬°Hola! Soy tu Tutor Virtual. ¬øQu√© te gustar√≠a hacer?"

  utter_menu_proceso_academico:
    - text: "Men√∫ acad√©mico: Tutor asignado ‚Ä¢ Certificados ‚Ä¢ Horarios/Calendario."

  utter_tutor_asignado:
    - text: "Para ver tu tutor asignado, primero inicia sesi√≥n."

  # --- Atajos demo ---
  utter_enviar_correo:
    - text: "Correo enviado (demo)."

  utter_enviar_telefono:
    - text: "Nuestro tel√©fono de contacto es 300 000 0000 (demo)."

  utter_enviar_cedula:
    - text: "Tu c√©dula estar√° disponible tras verificar tu identidad (demo)."

  utter_enviar_url:
    - text: "Enlace: https://ejemplo.edu (demo)."

  # --- Soporte / AVA ---
  utter_soporte_tecnico:
    - text: "Describe el problema t√©cnico y abrimos un ticket."

  utter_soporte_confirm:
    - text: "¬øConfirmas que enviemos el ticket con la informaci√≥n capturada?"

  utter_soporte_creado:
    - text: "üé´ Ticket creado correctamente."

  utter_soporte_error:
    - text: "‚ö†Ô∏è No pudimos crear el ticket en este momento. Intenta m√°s tarde."

  utter_soporte_ava:
    - text: "Soporte AVA: cu√©ntame el problema con el aula virtual."

  # --- Preguntas del form ---
  utter_ask_nombre:
    - text: "¬øCu√°l es tu nombre completo?"

  utter_ask_email:
    - text: "¬øCu√°l es tu correo electr√≥nico?"

  utter_ask_mensaje:
    - text: "Cu√©ntame brevemente el problema (m√≠nimo 8 caracteres)."

  # --- Escalado a humano ---
  utter_escalar_humano:
    - text: "¬øDeseas que te conecte con un agente humano?"

  utter_confirmar_escalado:
    - text: "Perfecto, estoy escalando tu caso a un agente humano. ‚è≥"

  utter_gracias_continuar:
    - text: "¬°Listo! Continuemos por aqu√≠."

  # --- Recuperaci√≥n de contrase√±a ---
  utter_confirmar_recuperacion:
    - text: "Te enviar√© un enlace de recuperaci√≥n al correo indicado."

  # --- Mensaje para errores de actividad ---
  utter_error_actividad:
    - text: "Parece que tienes un error con tu actividad. ¬øPodr√≠as especificar cu√°l?"

forms:
  soporte_form:
    required_slots:
      - nombre
      - email
      - mensaje
  recovery_form:
    required_slots:
      - email

actions:
  # Auth gating + sincronizaci√≥n
  - action_check_auth
  - action_check_auth_estado
  - action_sync_auth_from_metadata

  # Flujos con auth (demo/real)
  - action_estado_estudiante
  - action_ver_certificados
  - action_tutor_asignado

  # Soporte / correo / humano
  - action_enviar_soporte
  - action_soporte_submit
  - action_submit_soporte
  - action_enviar_correo
  - action_conectar_humano

  # Health / recovery
  - action_health_check
  - action_submit_recovery

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
