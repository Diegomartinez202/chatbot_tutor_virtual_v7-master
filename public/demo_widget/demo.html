<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Chatbot Tutor Virtual Zajuna</title>
    <link rel="stylesheet" href="chatbot-widget.css" />
    <style>
        :root {
            --accent-color: #0066cc;
            --bg-color: #f5f5f5;
            --text-color: #222;
        }

        [data-theme="dark"] {
            --accent-color: #2196f3;
            --bg-color: #121212;
            --text-color: #eee;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            background: var(--bg-color);
            color: var(--text-color);
            transition: background 0.3s, color 0.3s;
        }

        header {
            background: var(--accent-color);
            color: white;
            text-align: center;
            padding: 1rem;
        }

        main {
            padding: 2rem;
            max-width: 800px;
            margin: auto;
        }

        #mode-indicator {
            text-align: center;
            font-size: 14px;
            opacity: 0.85;
        }

        .theme-toggle,
        .mode-toggle {
            position: fixed;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
            z-index: 9999;
        }

            .theme-toggle:hover,
            .mode-toggle:hover {
                transform: scale(1.1);
            }

        .theme-toggle {
            bottom: 120px;
            right: 20px;
        }

        .mode-toggle {
            bottom: 60px;
            right: 20px;
        }
    </style>
</head>
<body data-theme="light">
    <header>
        <h1>Chatbot Tutor Virtual Zajuna – Sustentación</h1>
        <p id="mode-indicator"></p>
    </header>

    <main>
        <p>
            Este widget se conecta directamente al backend FastAPI y Rasa.
            Puedes alternar entre modo <strong>DEMO</strong> y <strong>REAL</strong>
            para mostrar ambos flujos de autenticación durante la sustentación.
        </p>
    </main>

    <!-- Botones de tema y modo -->
    <button class="theme-toggle" id="theme-toggle">🌓</button>
    <button class="mode-toggle" id="mode-toggle">🔧</button>

    <!-- Chatbot widget -->
    <script src="chatbot-widget.js" defer></script>

    <script>
        // === CONFIGURACIÓN INICIAL ===
        const API_URL = "http://127.0.0.1:8000/chat";
        const DEMO_TOKEN = "FAKE_TOKEN_ZAJUNA";
        let demoMode = true; // por defecto en sustentación

        const modeIndicator = document.getElementById("mode-indicator");
        const modeButton = document.getElementById("mode-toggle");
        const themeButton = document.getElementById("theme-toggle");

        // === FUNCIÓN PARA ACTUALIZAR MODO ===
        function updateModeIndicator() {
            modeIndicator.textContent = demoMode
                ? "🔧 Modo DEMO activo (usa token simulado Zajuna)"
                : "🔒 Modo REAL (requiere autenticación real)";
            modeButton.textContent = demoMode ? "🔧" : "🔒";
        }

        // === FUNCIÓN PARA PROBAR BACKEND ===
        function testConnection() {
            const authHeader = demoMode ? `Bearer ${DEMO_TOKEN}` : "";
            console.log("🌐 Enviando mensaje al backend...");
            fetch(API_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    ...(authHeader && { Authorization: authHeader })
                },
                body: JSON.stringify({ message: "Hola bot desde " + (demoMode ? "DEMO" : "REAL") })
            })
                .then(res => res.json())
                .then(data => console.log("✅ Respuesta del backend:", data))
                .catch(err => console.error("❌ Error al conectar:", err));
        }

        // === TOGGLE MODO DEMO / REAL ===
        modeButton.addEventListener("click", () => {
            demoMode = !demoMode;
            updateModeIndicator();
            testConnection();
        });

        // === TOGGLE TEMA OSCURO / CLARO ===
        themeButton.addEventListener("click", () => {
            const body = document.body;
            const current = body.getAttribute("data-theme");
            const next = current === "dark" ? "light" : "dark";
            body.setAttribute("data-theme", next);
        });

        // === INICIALIZACIÓN ===
        updateModeIndicator();
        testConnection();
    </script>
</body>
</html>